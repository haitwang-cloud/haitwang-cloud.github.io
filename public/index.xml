<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Welcome to My Blog on Tim Wangçš„æŠ€æœ¯åšå®¢</title>
    <link>http://localhost:1313/</link>
    <description>Recent content in Welcome to My Blog on Tim Wangçš„æŠ€æœ¯åšå®¢</description>
    <generator>Hugo</generator>
    <language>zh-CN</language>
    <lastBuildDate>Fri, 14 Jun 2024 17:47:42 +0800</lastBuildDate>
    <atom:link href="http://localhost:1313/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Istio Upstream Error</title>
      <link>http://localhost:1313/istio/istio-upstream-error/</link>
      <pubDate>Fri, 14 Jun 2024 17:47:42 +0800</pubDate>
      <guid>http://localhost:1313/istio/istio-upstream-error/</guid>
      <description>æœ¬æ–‡æ˜¯How to debug Istio Upstream Reset 502 UPE (old 503 UC)çš„ä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬ï¼Œå†…å®¹æœ‰åˆ å‡&#xA;Istio æ˜¯ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿã€‚å¯¹äºåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå®ƒçš„ä¸»è¦ç»„ä»¶æ˜¯ sidecar å®¹å™¨ Istio-Proxyï¼Œå®ƒä»£ç† Pod ä¸­æ‰€æœ‰å®¹å™¨çš„æµé‡ã€‚è€Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ã€‚&#xA;é—®é¢˜é‡ç°ğŸ› åœ¨ä¸€ä¸ªæ‹¥æœ‰è¶…è¿‡ 40 ä¸ªä¸åŒå¾®æœåŠ¡çš„å¤§å‹ç³»ç»Ÿä¸­ï¼ŒQAå·¥ç¨‹å¸ˆåœ¨å•ä¸ªç«¯ç‚¹ä¸Šå‘ç°äº†ä¸€ä¸ªbugã€‚è¿™è¯¥ç«¯ç‚¹æ˜¯ POST ç«¯ç‚¹ï¼Œå®ƒè¿”å›åˆ†å—ï¼ˆchunkedï¼‰æ•°æ®ã€‚&#xA;ç„¶åæˆ‘ä»¬å‘ç° Istio è¿”å›äº† 502 é”™è¯¯ï¼ŒIstioæ—¥å¿—ä¸­è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„æ ‡å¿—ï¼šupstream_reset_before_response_startedã€‚ç„¶è€Œåº”ç”¨ç¨‹åºæ—¥å¿—è¯å®äº†ç»“æœæ˜¯æ­£ç¡®çš„ã€‚&#xA;åœ¨æ—§ç‰ˆæœ¬çš„ Istio ä¸­ï¼Œå®ƒä¼šè¿”å› 503 é”™è¯¯ï¼Œå¸¦æœ‰ UC æ ‡å¿—ã€‚&#xA;é—®é¢˜åˆ†æâ›ï¸ è®©æˆ‘ä»¬çœ‹çœ‹ curl çš„å“åº”ï¼Œä»¥åŠ Istio-proxy çš„æ—¥å¿—ï¼š&#xA;kubectl exec -it curl-0 -- curl http://http-chunked:8080/wrong -v &amp;lt; HTTP/1.1 502 Bad Gateway &amp;lt; content-length: 87 &amp;lt; content-type: text/plain &amp;lt; date: Sun, 24 Apr 2022 12:28:28 GMT &amp;lt; server: istio-envoy &amp;lt; x-envoy-decorator-operation: http-chunked.</description>
    </item>
    <item>
      <title>å¦‚ä½•è§£å†³ `Failed to initialize NVML: Unknown Error` é—®é¢˜</title>
      <link>http://localhost:1313/gpu/nvml-error/</link>
      <pubDate>Fri, 14 Jun 2024 17:42:52 +0800</pubDate>
      <guid>http://localhost:1313/gpu/nvml-error/</guid>
      <description>æœ¬æ–‡æ˜¯NOTICE: Containers losing access to GPUs with error: &amp;ldquo;Failed to initialize NVML: Unknown Error&amp;rdquo;çš„ä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬ï¼Œå†…å®¹æœ‰åˆ å‡ï¼Œäº²æµ‹è¯¥æ–¹æ³•æœ‰æ•ˆã€‚&#xA;å¦‚ä½•è§£å†³ Failed to initialize NVML: Unknown Error é—®é¢˜ æ¦‚è¿° åœ¨æŸäº›ç‰¹å®šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‘ç°k8så®¹å™¨å¯èƒ½ä¼šçªç„¶ä»æœ€åˆè¿æ¥åˆ°çš„GPUä¸Šåˆ†ç¦»ã€‚æˆ‘ä»¬å·²ç»ç¡®å®šäº†è¿™ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œå¹¶ç¡®å®šäº†å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µçš„å—å½±å“ç¯å¢ƒã€‚åœ¨æœ¬æ–‡æ¡£çš„æœ«å°¾æä¾›äº†å—å½±å“ç¯å¢ƒçš„è§£å†³æ–¹æ³•ï¼Œç›´åˆ°å‘å¸ƒé€‚å½“çš„ä¿®å¤ä¸ºæ­¢ã€‚&#xA;é—®é¢˜æ€»ç»“ æˆ‘ä»¬å‘ç°å½“ä½¿ç”¨containeræ¥ç®¡ç†GPUå·¥ä½œè´Ÿè½½æ—¶ï¼Œç”¨æˆ·containerå¯èƒ½ä¼šçªç„¶å¤±å»å¯¹GPUçš„è®¿é—®æƒé™ã€‚è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨ä½¿ç”¨systemdæ¥ç®¡ç†å®¹å™¨çš„cgroupsæ—¶ï¼Œå½“è§¦å‘é‡æ–°åŠ è½½ä»»ä½•åŒ…å«å¯¹NVIDIA GPUçš„å¼•ç”¨çš„Unitæ–‡ä»¶æ—¶ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡æ‰§è¡Œsystemctl daemon-reloadï¼‰ã€‚&#xA;å½“ä½ çš„containerå¤±å»å¯¹GPUçš„è®¿é—®æƒé™æ—¶ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹é”™è¯¯æ¶ˆæ¯ï¼š&#xA;Failed to initialize NVML: Unknown Error ä¸€æ—¦å‘ç”Ÿä¸Šè¿° â¬†ï¸ï¼Œå°±éœ€è¦æ‰‹åŠ¨åˆ é™¤å—å½±å“çš„containerï¼Œç„¶åé‡æ–°å¯åŠ¨å®ƒä»¬ã€‚&#xA;å½“containeré‡æ–°å¯åŠ¨ï¼ˆæ‰‹åŠ¨æˆ–è‡ªåŠ¨ï¼Œå–å†³äºæ˜¯å¦ä½¿ç”¨å®¹å™¨ç¼–æ’å¹³å°ï¼‰ï¼Œå®ƒå°†é‡æ–°è·å¾—å¯¹GPUçš„è®¿é—®æƒé™ã€‚&#xA;æ­¤é—®é¢˜çš„æ ¹æºåœ¨äºï¼Œæœ€è¿‘ç‰ˆæœ¬çš„runcè¦æ±‚åœ¨/dev/charä¸‹é¢ä¸ºæ³¨å…¥åˆ°å®¹å™¨ä¸­çš„ä»»ä½•è®¾å¤‡èŠ‚ç‚¹æä¾›ç¬¦å·é“¾æ¥ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒNVIDIAè®¾å¤‡å¹¶æ²¡æœ‰è¿™äº›ç¬¦å·é“¾æ¥ï¼ŒNVIDIA GPUé©±åŠ¨ä¹Ÿæ²¡æœ‰ï¼ˆå½“å‰ï¼‰æä¾›è‡ªåŠ¨åˆ›å»ºè¿™äº›é“¾æ¥çš„æ–¹æ³•&#xA;å—å½±å“çš„ç¯å¢ƒ å¦‚æœä½ ä½¿ç”¨runcå¹¶åœ¨é«˜çº§å®¹å™¨è¿è¡Œæ—¶ï¼ˆCRIï¼‰å¯ç”¨systemd cgroupç®¡ç†çš„ç¯å¢ƒï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šå—åˆ°è¿™ä¸ªé—®é¢˜çš„å½±å“&#xA;å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨systemdæ¥ç®¡ç†cgroupï¼Œé‚£ä¹ˆå®ƒå°±ä¸ä¼šå—åˆ°è¿™ä¸ªé—®é¢˜çš„å½±å“ã€‚ ä¸‹é¢æ˜¯å¯èƒ½ä¼šå—å½±å“çš„çš„ç¯å¢ƒçš„è¯¦å°½åˆ—è¡¨:&#xA;ä½¿ç”¨containerd/runcçš„Dockerç¯å¢ƒ ç‰¹å®šæ¡ä»¶ å¯ç”¨äº†systemdçš„cgroupé©±åŠ¨ç¨‹åºï¼ˆä¾‹å¦‚ï¼Œåœ¨/etc/docker/daemon.jsonä¸­è®¾ç½®äº†å‚æ•°&amp;quot;exec-opts&amp;quot;: [&amp;quot;native.cgroupdriver=systemd&amp;quot;]ï¼‰ ä½¿ç”¨äº†æ›´æ–°çš„Dockerç‰ˆæœ¬ï¼Œå…¶ä¸­systemd cgroupç®¡ç†è¢«é»˜è®¤è®¾ç½®çš„ï¼ˆå³ï¼Œåœ¨Ubuntu 22.04ä¸Šï¼‰ã€‚ Noteå¦‚æœä½ è¦æ£€æŸ¥Dockeræ˜¯å¦ä½¿ç”¨systemd cgroupç®¡ç†ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆä¸‹é¢çš„è¾“å‡ºè¡¨ç¤ºå¯ç”¨äº†systemd cgroupé©±åŠ¨ç¨‹åºï¼‰&#xA;$ docker info ... Cgroup Driver: systemd Cgroup Version: 1 ä½¿ç”¨containerd/runcçš„Kubernetesç¯å¢ƒ ç‰¹å®šæ¡ä»¶ åœ¨containerdé…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸ä½äºï¼š/etc/containerd/config.tomlï¼‰ä¸­è®¾ç½®SystemdCgroup = trueï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š [plugins.</description>
    </item>
    <item>
      <title>OCI runtime create failed: expected cgroupsPath</title>
      <link>http://localhost:1313/k8s/oci-error/</link>
      <pubDate>Fri, 14 Jun 2024 16:58:03 +0800</pubDate>
      <guid>http://localhost:1313/k8s/oci-error/</guid>
      <description>æœ¬æ–‡æ˜¯é’ˆå¯¹ä½œè€…é‡åˆ°çš„OCI runtime create failed: expected cgroupsPath to be of format \&amp;quot;slice:prefix:name\&amp;quot; for systemd cgroups, got \&amp;quot;/kubepods/burstable/...&amp;quot;çš„é—®é¢˜æ€»ç»“&#xA;é—®é¢˜æ€»ç»“ é—®é¢˜æè¿° åœ¨ç‰¹å®šçš„k8s nodeä¸Šä¸èƒ½é€šè¿‡containerdå¯åŠ¨pod,podçš„çŠ¶æ€ä¸€ç›´æ˜¯ContainerCreating,é€šè¿‡kubectl describe podæŸ¥çœ‹podçš„çŠ¶æ€,å‘ç°å¦‚ä¸‹é”™è¯¯:&#xA;OCI runtime create failed: runc create failed: expected cgroupsPath to be of format &amp;#34;slice:prefix:name&amp;#34; for systemd cgroups k8sé›†ç¾¤ä¿¡æ¯ k8sç‰ˆæœ¬: v1.26.13 containerdç‰ˆæœ¬: 1.6.24 Linnux kernelç‰ˆæœ¬: 6.6.20-amd64 Linuxå‘è¡Œç‰ˆ: Garden Linux 1443.0 kubeProxyVersion: v1.26.13 kubeletVersion: v1.26.13 é—®é¢˜åˆ†æ æ­¤é—®é¢˜æ˜¯å› ä¸ºkubeleté…ç½®ä¸ºä½¿ç”¨cgroupfs cgroupé©±åŠ¨ç¨‹åºï¼Œè€Œcontainerdé…ç½®ä¸ºä½¿ç”¨sytemd cgroupé©±åŠ¨ç¨‹åºã€‚&#xA;è§£å†³æ–¹æ³• ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œå¯ä»¥ä»ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¸­é€‰æ‹©ä¸€ç§ï¼š&#xA;è®©containerdä½¿ç”¨cgroupfsé©±åŠ¨ç¨‹åºï¼Œéœ€è¦ä»/etc/containerd/config.tomlä¸­åˆ é™¤SystemdCgroup = trueè¡Œã€‚ è®©kubeletä½¿ç”¨systemdé©±åŠ¨ç¨‹åºï¼Œéœ€è¦å°†KubeletConfigurationä¸­çš„cgroupDriverè®¾ç½®ä¸º&amp;quot;systemd&amp;quot;ã€‚ æ‰©å±•é˜…è¯» æŸ¥çœ‹Kubeleté…ç½® Kubeletçš„é…ç½®æ–‡ä»¶é€šå¸¸ä½äº/var/lib/kubelet/ä½ç½®ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹è¯¥æ–‡ä»¶æ¥ç¡®è®¤Kubeletçš„cgroupé©±åŠ¨ç¨‹åºé…ç½®ã€‚å…³äºå…¶ä»–CRIsçš„é…ç½®æ–‡ä»¶ä½ç½®å¯ä»¥å‚è€ƒContainer Runtimesã€‚</description>
    </item>
  </channel>
</rss>
