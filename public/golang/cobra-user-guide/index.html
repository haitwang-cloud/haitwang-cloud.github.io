<!doctype html>




<script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1313460867822205"
     crossorigin="anonymous"></script>





































<html
  class="not-ready lg:text-base"
  style="--bg: #f8f5d7"
  lang="zh-CN"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>Cobra 命令行工具使用指南 - Tim Wang Tech Blog</title>

  
  <meta name="theme-color" />

  
  
  
  
  <meta name="description" content="本文是cobra的官方readme的中文翻译版本
用户指南 当你想要用cobra来构建自己的应用时，你可以按照下面的结构来组织你的cobra应用：
▾ appName/ ▾ cmd/ add.go your.go commands.go here.go main.go 在一个cobra应用中，通常main.go文件非常简单，它只有一个目的：初始化cobra。
package main import ( &#34;{pathToYourApp}/cmd&#34; ) func main() { cmd.Execute() } 使用Cobra Generator Cobra-CLI 是一个独立的程序，它将创建您的应用程序并添加您想要的任何命令。 这是将 Cobra 集成到您的应用程序的最简单方法。
关于使用Cobra generator的细节，可以参考The Cobra-CLI Generator README
使用Cobra库 要实现 Cobra，您需要创建一个空的 main.go 文件和一个 rootCmd 文件。 您可以根据需要选择性地提供其他命令。
创建rootCmd Cobra 不需要任何特殊的构造函数。只需创建命令即可。
您可以把下面的内容放在 app/cmd/root.go 中。
var rootCmd = &amp;cobra.Command{ Use: &#34;hugo&#34;, Short: &#34;Hugo is a very fast static site generator&#34;, Long: `A Fast and Flexible Static Site Generator built with love by spf13 and friends in Go." />
  <meta name="author" content="Tim Wang" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="http://localhost:1313/main.min.css" />

  
  
  
  
  
  <link rel="preload" as="image" href="http://localhost:1313/theme.png" />

  
  
  
  
  <link rel="preload" as="image" href="https://gravatar.com/haitaoking1993" />
  
  

  
  
  <link rel="preload" as="image" href="http://localhost:1313/github.svg" />
  
  <link rel="preload" as="image" href="http://localhost:1313/linkedin.svg" />
  
  <link rel="preload" as="image" href="http://localhost:1313/rss.svg" />
  
  

  
  
  <script
    defer
    src="http://localhost:1313/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  
  

  
  <link rel="icon" href="http://localhost:1313/favicon.ico" />
  <link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.127.0">

  
  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold"
      href="http://localhost:1313/"
      >Tim Wang Tech Blog</a
    >
    <div
      class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  

  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#f8f5d7'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href="https://github.com/haitwang-cloud"
        target="_blank"
        rel="me"
      >
        github
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./linkedin.svg)"
        href="https://linkedin.com/in/tim-wang-505213166"
        target="_blank"
        rel="me"
      >
        linkedin
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./rss.svg)"
        href="http://localhost:1313/index.xml"
        target="_blank"
        rel="alternate"
      >
        rss
      </a>
      
    </nav>
    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"
    >
      

<article>
  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">Cobra 命令行工具使用指南</h1>

    
    <div class="text-sm antialiased opacity-60">
      
      <time>Jun 19, 2024</time>
      
      
      
      
    </div>
    
  </header>

  <section><blockquote>
<p>本文是<a href="https://github.com/spf13/cobra/blob/main/site/content/user_guide.md">cobra的官方readme</a>的中文翻译版本</p>
</blockquote>
<h1 id="用户指南">用户指南</h1>
<p>当你想要用cobra来构建自己的应用时，你可以按照下面的结构来组织你的cobra应用：</p>
<pre tabindex="0"><code>  ▾ appName/
    ▾ cmd/
        add.go
        your.go
        commands.go
        here.go
      main.go
</code></pre><p>在一个cobra应用中，通常main.go文件非常简单，它只有一个目的：初始化cobra。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;{pathToYourApp}/cmd&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">Execute</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="使用cobra-generator">使用Cobra Generator</h2>
<p>Cobra-CLI 是一个独立的程序，它将创建您的应用程序并添加您想要的任何命令。
这是将 Cobra 集成到您的应用程序的最简单方法。</p>
<p>关于使用Cobra generator的细节，可以参考<a href="https://github.com/spf13/cobra-cli/blob/main/README.md">The Cobra-CLI Generator README</a></p>
<h2 id="使用cobra库">使用Cobra库</h2>
<p>要实现 Cobra，您需要创建一个空的 <code>main.go</code> 文件和一个 <code>rootCmd</code> 文件。
您可以根据需要选择性地提供其他命令。</p>
<h3 id="创建rootcmd">创建rootCmd</h3>
<p>Cobra 不需要任何特殊的构造函数。只需创建命令即可。</p>
<p>您可以把下面的内容放在 app/cmd/root.go 中。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rootCmd</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Use</span>:   <span style="color:#e6db74">&#34;hugo&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Short</span>: <span style="color:#e6db74">&#34;Hugo is a very fast static site generator&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Long</span>: <span style="color:#e6db74">`A Fast and Flexible Static Site Generator built with
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                love by spf13 and friends in Go.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Complete documentation is available at https://gohugo.io/documentation/`</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Do Stuff Here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  },
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Execute</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">Execute</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintln</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stderr</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>您还将在 <code>init()</code> 函数中定义<code>flag</code>和对应的处理函数。</p>
<p>例如，在 <code>cmd/root.go</code> 文件中可以这样写：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">cmd</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/spf13/cobra&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/spf13/viper&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Used for flags.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">cfgFile</span>     <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">userLicense</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rootCmd</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Use</span>:   <span style="color:#e6db74">&#34;cobra-cli&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Short</span>: <span style="color:#e6db74">&#34;A generator for Cobra based Applications&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Long</span>: <span style="color:#e6db74">`Cobra is a CLI library for Go that empowers applications.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">This application is a tool to generate the needed files
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">to quickly create a Cobra application.`</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Execute executes the root command.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Execute</span>() <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">Execute</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">OnInitialize</span>(<span style="color:#a6e22e">initConfig</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">PersistentFlags</span>().<span style="color:#a6e22e">StringVar</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cfgFile</span>, <span style="color:#e6db74">&#34;config&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;config file (default is $HOME/.cobra.yaml)&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">PersistentFlags</span>().<span style="color:#a6e22e">StringP</span>(<span style="color:#e6db74">&#34;author&#34;</span>, <span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;YOUR NAME&#34;</span>, <span style="color:#e6db74">&#34;author name for copyright attribution&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">PersistentFlags</span>().<span style="color:#a6e22e">StringVarP</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">userLicense</span>, <span style="color:#e6db74">&#34;license&#34;</span>, <span style="color:#e6db74">&#34;l&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;name of license for the project&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">PersistentFlags</span>().<span style="color:#a6e22e">Bool</span>(<span style="color:#e6db74">&#34;viper&#34;</span>, <span style="color:#66d9ef">true</span>, <span style="color:#e6db74">&#34;use Viper for configuration&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">viper</span>.<span style="color:#a6e22e">BindPFlag</span>(<span style="color:#e6db74">&#34;author&#34;</span>, <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">PersistentFlags</span>().<span style="color:#a6e22e">Lookup</span>(<span style="color:#e6db74">&#34;author&#34;</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">viper</span>.<span style="color:#a6e22e">BindPFlag</span>(<span style="color:#e6db74">&#34;useViper&#34;</span>, <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">PersistentFlags</span>().<span style="color:#a6e22e">Lookup</span>(<span style="color:#e6db74">&#34;viper&#34;</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">viper</span>.<span style="color:#a6e22e">SetDefault</span>(<span style="color:#e6db74">&#34;author&#34;</span>, <span style="color:#e6db74">&#34;NAME HERE &lt;EMAIL ADDRESS&gt;&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">viper</span>.<span style="color:#a6e22e">SetDefault</span>(<span style="color:#e6db74">&#34;license&#34;</span>, <span style="color:#e6db74">&#34;apache&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">AddCommand</span>(<span style="color:#a6e22e">addCmd</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">AddCommand</span>(<span style="color:#a6e22e">initCmd</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">initConfig</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">cfgFile</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Use config file from the flag.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">viper</span>.<span style="color:#a6e22e">SetConfigFile</span>(<span style="color:#a6e22e">cfgFile</span>)
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Find home directory.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">home</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">UserHomeDir</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">CheckErr</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Search config in home directory with name &#34;.cobra&#34; (without extension).
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">viper</span>.<span style="color:#a6e22e">AddConfigPath</span>(<span style="color:#a6e22e">home</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">viper</span>.<span style="color:#a6e22e">SetConfigType</span>(<span style="color:#e6db74">&#34;yaml&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">viper</span>.<span style="color:#a6e22e">SetConfigName</span>(<span style="color:#e6db74">&#34;.cobra&#34;</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">viper</span>.<span style="color:#a6e22e">AutomaticEnv</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">viper</span>.<span style="color:#a6e22e">ReadInConfig</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Using config file:&#34;</span>, <span style="color:#a6e22e">viper</span>.<span style="color:#a6e22e">ConfigFileUsed</span>())
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="创建你的maingo文件">创建你的main.go文件</h3>
<p>你需要在你的main函数中执行root命令。为了清晰起见，应该在root上执行Execute（其实它可以在任何命令上执行）。</p>
<p>在一个Cobra应用中，通常main.go文件非常简单，它只有一个目的：初始化Cobra。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;{pathToYourApp}/cmd&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">Execute</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="创建其他命令">创建其他命令</h3>
<blockquote>
<p>您可以在cmd/目录下的文件中单独定义和创建其他命令。</p>
</blockquote>
<p>如果你想创建一个version命令，你可以创建cmd/version.go文件，并写上以下内容：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">cmd</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;github.com/spf13/cobra&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">AddCommand</span>(<span style="color:#a6e22e">versionCmd</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">versionCmd</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Use</span>:   <span style="color:#e6db74">&#34;version&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Short</span>: <span style="color:#e6db74">&#34;Print the version number of Hugo&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Long</span>:  <span style="color:#e6db74">`All software has versions. This is Hugo&#39;s`</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Hugo Static Site Generator v0.9 -- HEAD&#34;</span>)
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="添加子命令">添加子命令</h3>
<p>一个命令可以有子命令，子命令也可以有其他子命令。这可以通过使用 <code>AddCommand</code> 来实现。在某些情况下，尤其是在较大的应用程序中，每个子命令可能定义在自己的 Go 包中。</p>
<p>建议的方法是父命令使用 <code>AddCommand</code> 来添加其最直接的子命令。例如，考虑以下目录结构：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>├── cmd
</span></span><span style="display:flex;"><span>│   ├── root.go
</span></span><span style="display:flex;"><span>│   └── sub1
</span></span><span style="display:flex;"><span>│       ├── sub1.go
</span></span><span style="display:flex;"><span>│       └── sub2
</span></span><span style="display:flex;"><span>│           ├── leafA.go
</span></span><span style="display:flex;"><span>│           ├── leafB.go
</span></span><span style="display:flex;"><span>│           └── sub2.go
</span></span><span style="display:flex;"><span>└── main.go
</span></span></code></pre></div><p>在这种情况下：</p>
<ul>
<li><code>root.go</code>的<code>init</code>函数将<code>sub1.go</code>中定义的命令添加到root命令。</li>
<li><code>sub1.go</code>的<code>init</code>函数将<code>sub2.go</code>中定义的命令添加到sub1命令。</li>
<li><code>sub2.go</code>的<code>init</code>函数将<code>leafA.go</code>和<code>leafB.go</code>中定义的命令添加到sub2命令。</li>
</ul>
<p>这个方法确保了子命令在编译时被包含进来，同时避免了循环引用的发生。</p>
<h3 id="返回和处理错误">返回和处理错误</h3>
<p>If you wish to return an error to the caller of a command, <code>RunE</code> can be used.
如果您想将错误返回给命令的调用方，可以使用 <code>RunE</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">cmd</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;github.com/spf13/cobra&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">AddCommand</span>(<span style="color:#a6e22e">tryCmd</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">tryCmd</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Use</span>:   <span style="color:#e6db74">&#34;try&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Short</span>: <span style="color:#e6db74">&#34;Try and possibly fail at something&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">RunE</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">someFunc</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>上面的错误可以在执行函数调用时被捕获。</p>
<h2 id="使用flag-flags">使用flag Flags</h2>
<p>Flags 提供了修改器来控制命令的操作。</p>
<h3 id="在命令中使用flag">在命令中使用flag</h3>
<p>由于flag是在不同的位置定义和使用的，因此我们需要在外部定义一个变量，来为它分配flag进行操作。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Verbose</span> <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Source</span> <span style="color:#66d9ef">string</span>
</span></span></code></pre></div><p>有两种不同的方法来使用一个flag。</p>
<h3 id="全局flag持久化flag">全局flag（持久化flag）</h3>
<p>一个flag可以是“永久的”，这意味着该flag将对它所分配的命令以及该命令下的所有命令都有效。对于全局flag，请在root命令上将flag分配为永久flag。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">PersistentFlags</span>().<span style="color:#a6e22e">BoolVarP</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Verbose</span>, <span style="color:#e6db74">&#34;verbose&#34;</span>, <span style="color:#e6db74">&#34;v&#34;</span>, <span style="color:#66d9ef">false</span>, <span style="color:#e6db74">&#34;verbose output&#34;</span>)
</span></span></code></pre></div><h3 id="局部flag">局部flag</h3>
<p>一个flag也可以被分配为局部flag，这将只适用于该特定命令。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">localCmd</span>.<span style="color:#a6e22e">Flags</span>().<span style="color:#a6e22e">StringVarP</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Source</span>, <span style="color:#e6db74">&#34;source&#34;</span>, <span style="color:#e6db74">&#34;s&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;Source directory to read from&#34;</span>)
</span></span></code></pre></div><h3 id="从父命令中获取局部flag">从父命令中获取局部flag</h3>
<p>默认情况下，Cobra只解析命令上的本地flag，父命令上的任何本地flag都会被忽略。通过启用 <code>Command.TraverseChildren</code>，Cobra将在执行目标命令之前解析每个命令上的本地flag。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">command</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Use</span>: <span style="color:#e6db74">&#34;print [OPTIONS] [COMMANDS]&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">TraverseChildren</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="使用config绑定flag">使用config绑定flag</h3>
<p>You can also bind your flags with <a href="https://github.com/spf13/viper">viper</a>: 您也可以使用<a href="https://github.com/spf13/viper">viper</a>来绑定您的flag：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">author</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">PersistentFlags</span>().<span style="color:#a6e22e">StringVar</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">author</span>, <span style="color:#e6db74">&#34;author&#34;</span>, <span style="color:#e6db74">&#34;YOUR NAME&#34;</span>, <span style="color:#e6db74">&#34;Author name for copyright attribution&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">viper</span>.<span style="color:#a6e22e">BindPFlag</span>(<span style="color:#e6db74">&#34;author&#34;</span>, <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">PersistentFlags</span>().<span style="color:#a6e22e">Lookup</span>(<span style="color:#e6db74">&#34;author&#34;</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>在本例中，永久flag <code>author</code> 使用 <code>viper</code> 绑定。</p>
<blockquote>
<p>注意：当用户提供 <code>--author</code> 标志时，变量 <code>author</code> 将不会被设置为配置文件中的值</p>
</blockquote>
<p>详情可以参考<a href="https://github.com/spf13/viper#working-with-flags">viper文档</a>.</p>
<h3 id="必需的flag">必需的flag</h3>
<p>默认情况下，flag是可选的。如果您希望您的命令在flag未设置时报告错误，可以将其标记为必需的：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">Flags</span>().<span style="color:#a6e22e">StringVarP</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Region</span>, <span style="color:#e6db74">&#34;region&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;AWS region (required)&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">MarkFlagRequired</span>(<span style="color:#e6db74">&#34;region&#34;</span>)
</span></span></code></pre></div><p>或者，对于持久flag：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">PersistentFlags</span>().<span style="color:#a6e22e">StringVarP</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Region</span>, <span style="color:#e6db74">&#34;region&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;AWS region (required)&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">MarkPersistentFlagRequired</span>(<span style="color:#e6db74">&#34;region&#34;</span>)
</span></span></code></pre></div><h3 id="flag-组">Flag 组</h3>
<p>如果你有不同的flag必须一起使用（例如，如果用户提供了 <code>--username</code> flag，他们必须同时提供 <code>--password</code> flag），那么Cobra可以通过下面的方式来做：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">Flags</span>().<span style="color:#a6e22e">StringVarP</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">u</span>, <span style="color:#e6db74">&#34;username&#34;</span>, <span style="color:#e6db74">&#34;u&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;Username (required if password is set)&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">Flags</span>().<span style="color:#a6e22e">StringVarP</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pw</span>, <span style="color:#e6db74">&#34;password&#34;</span>, <span style="color:#e6db74">&#34;p&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;Password (required if username is set)&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">MarkFlagsRequiredTogether</span>(<span style="color:#e6db74">&#34;username&#34;</span>, <span style="color:#e6db74">&#34;password&#34;</span>)
</span></span></code></pre></div><p>如果不同的flag代表互斥的选项，你可以这样做。例如指定一个输出格式为 <code>--json</code> 或 <code>--yaml</code>，但从不同时使用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">Flags</span>().<span style="color:#a6e22e">BoolVar</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ofJson</span>, <span style="color:#e6db74">&#34;json&#34;</span>, <span style="color:#66d9ef">false</span>, <span style="color:#e6db74">&#34;Output in JSON&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">Flags</span>().<span style="color:#a6e22e">BoolVar</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ofYaml</span>, <span style="color:#e6db74">&#34;yaml&#34;</span>, <span style="color:#66d9ef">false</span>, <span style="color:#e6db74">&#34;Output in YAML&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">MarkFlagsMutuallyExclusive</span>(<span style="color:#e6db74">&#34;json&#34;</span>, <span style="color:#e6db74">&#34;yaml&#34;</span>)
</span></span></code></pre></div><p>如果你想要至少一个flag必须存在，你可以使用 <code>MarkFlagsOneRequired</code>。这可以与 <code>MarkFlagsMutuallyExclusive</code> 结合使用，以强制执行给定组中的一个flag：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">Flags</span>().<span style="color:#a6e22e">BoolVar</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ofJson</span>, <span style="color:#e6db74">&#34;json&#34;</span>, <span style="color:#66d9ef">false</span>, <span style="color:#e6db74">&#34;Output in JSON&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">Flags</span>().<span style="color:#a6e22e">BoolVar</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ofYaml</span>, <span style="color:#e6db74">&#34;yaml&#34;</span>, <span style="color:#66d9ef">false</span>, <span style="color:#e6db74">&#34;Output in YAML&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">MarkFlagsOneRequired</span>(<span style="color:#e6db74">&#34;json&#34;</span>, <span style="color:#e6db74">&#34;yaml&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">MarkFlagsMutuallyExclusive</span>(<span style="color:#e6db74">&#34;json&#34;</span>, <span style="color:#e6db74">&#34;yaml&#34;</span>)
</span></span></code></pre></div><blockquote>
<p>在这些情况下：</p>
<ul>
<li>本地和持久flag都可以使用
<ul>
<li>**注意：**该组仅在定义了每个flag的命令上强制执行</li>
</ul>
</li>
<li>一个flag可以出现在多个组中</li>
<li>一个组可以包含任意数量的flag</li>
</ul>
</blockquote>
<h2 id="潜在的参数和自定义的参数">潜在的参数和自定义的参数</h2>
<p>潜在参数的验证可以使用<code>Command</code>的<code>Args</code>字段来指定。
以下验证器是内置的：</p>
<ul>
<li>参数的数量：
<ul>
<li><code>NoArgs</code> - 如果有任何位置参数，则报告错误。</li>
<li><code>ArbitraryArgs</code> - 接受任意数量的参数。</li>
<li><code>MinimumNArgs(int)</code> - 如果提供的位置参数少于N个，则报告错误。</li>
<li><code>MaximumNArgs(int)</code> - 如果提供的位置参数多于N个，则报告错误。</li>
<li><code>ExactArgs(int)</code> - 如果位置参数不是N个，则报告错误。</li>
<li><code>RangeArgs(min, max)</code> - 如果参数的数量不在<code>min</code>和<code>max</code>之间，则报告错误。</li>
</ul>
</li>
</ul>
<p>如果<code>Args</code>未定义或为<code>nil</code>，则默认为<code>ArbitraryArgs</code>。</p>
<p>此外，<code>MatchAll(pargs ...PositionalArgs)</code> 允许将现有检查与任意其他检查组合。
例如，如果您想在没有确切的 N 个位置参数时报告错误，或在任何位置参数不在 <code>Command</code> 的 <code>ValidArgs</code> 字段中时报告错误，您可以调用 <code>MatchAll</code> 方法，并将 <code>ExactArgs</code> 和 <code>OnlyValidArgs</code> 方法作为参数传递</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cmd</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Short</span>: <span style="color:#e6db74">&#34;hello&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Args</span>: <span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">MatchAll</span>(<span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">ExactArgs</span>(<span style="color:#ae81ff">2</span>), <span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">OnlyValidArgs</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Hello, World!&#34;</span>)
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>可以设置任何满足以下签名的自定义验证器：
例如</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cmd</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Short</span>: <span style="color:#e6db74">&#34;hello&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Args</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Optionally run one of the validators provided by cobra
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">MinimumNArgs</span>(<span style="color:#ae81ff">1</span>)(<span style="color:#a6e22e">cmd</span>, <span style="color:#a6e22e">args</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Run the custom validation logic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">myapp</span>.<span style="color:#a6e22e">IsValidColor</span>(<span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>]) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;invalid color specified: %s&#34;</span>, <span style="color:#a6e22e">args</span>[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Hello, World!&#34;</span>)
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="example-例子">Example 例子</h2>
<p>在下面的例子中，我们定义了三个命令。两个在顶层，一个（cmdTimes）是顶级命令之一的子命令。在这种情况下，根命令不可执行，这意味着需要子命令。这是通过不为 <code>rootCmd</code> 提供 <code>Run</code> 方法来实现的。</p>
<p>我们只为单个命令定义了一个标志。</p>
<p>有关标志的更多文档可在 <a href="https://github.com/spf13/pflag">https://github.com/spf13/pflag</a> 上找到</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;github.com/spf13/cobra&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">echoTimes</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cmdPrint</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Use</span>:   <span style="color:#e6db74">&#34;print [string to print]&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Short</span>: <span style="color:#e6db74">&#34;Print anything to the screen&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Long</span>: <span style="color:#e6db74">`print is for printing anything back to the screen.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">For many years people have printed back to the screen.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Args</span>: <span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">MinimumNArgs</span>(<span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Print: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">args</span>, <span style="color:#e6db74">&#34; &#34;</span>))
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cmdEcho</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Use</span>:   <span style="color:#e6db74">&#34;echo [string to echo]&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Short</span>: <span style="color:#e6db74">&#34;Echo anything to the screen&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Long</span>: <span style="color:#e6db74">`echo is for echoing anything back.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Echo works a lot like print, except it has a child command.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Args</span>: <span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">MinimumNArgs</span>(<span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Echo: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">args</span>, <span style="color:#e6db74">&#34; &#34;</span>))
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cmdTimes</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Use</span>:   <span style="color:#e6db74">&#34;times [string to echo]&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Short</span>: <span style="color:#e6db74">&#34;Echo anything to the screen more times&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Long</span>: <span style="color:#e6db74">`echo things multiple times back to the user by providing
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">a count and a string.`</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Args</span>: <span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">MinimumNArgs</span>(<span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">echoTimes</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Echo: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">args</span>, <span style="color:#e6db74">&#34; &#34;</span>))
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">cmdTimes</span>.<span style="color:#a6e22e">Flags</span>().<span style="color:#a6e22e">IntVarP</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">echoTimes</span>, <span style="color:#e6db74">&#34;times&#34;</span>, <span style="color:#e6db74">&#34;t&#34;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;times to echo the input&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rootCmd</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{<span style="color:#a6e22e">Use</span>: <span style="color:#e6db74">&#34;app&#34;</span>}
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">AddCommand</span>(<span style="color:#a6e22e">cmdPrint</span>, <span style="color:#a6e22e">cmdEcho</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">cmdEcho</span>.<span style="color:#a6e22e">AddCommand</span>(<span style="color:#a6e22e">cmdTimes</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">Execute</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>如果你想要一个更完整的例子，可以看看<a href="https://gohugo.io/">Hugo</a>。</p>
<h2 id="help-命令">Help 命令</h2>
<p>Cobra 会自动在你的应用程序中添加一个 help 命令，当用户运行 <code>app help</code>时会调用它。此外，help 还支持所有其他命令作为输入。例如，假设你有一个名为 create 的命令，没有任何其他配置；当调用 <code>app help create</code>时，Cobra 将会正常工作。每个命令都会自动添加 <code>--help</code> 标志。</p>
<h3 id="例子">例子</h3>
<p>下面的输出是由Cobra自动生成的。除了命令和flag定义之外，不需要任何其他内容。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    $ cobra-cli help
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Cobra is a CLI library <span style="color:#66d9ef">for</span> Go that empowers applications.
</span></span><span style="display:flex;"><span>    This application is a tool to generate the needed files
</span></span><span style="display:flex;"><span>    to quickly create a Cobra application.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Usage:
</span></span><span style="display:flex;"><span>      cobra-cli <span style="color:#f92672">[</span>command<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Available Commands:
</span></span><span style="display:flex;"><span>      add         Add a command to a Cobra Application
</span></span><span style="display:flex;"><span>      completion  Generate the autocompletion script <span style="color:#66d9ef">for</span> the specified shell
</span></span><span style="display:flex;"><span>      help        Help about any command
</span></span><span style="display:flex;"><span>      init        Initialize a Cobra Application
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Flags:
</span></span><span style="display:flex;"><span>      -a, --author string    author name <span style="color:#66d9ef">for</span> copyright attribution <span style="color:#f92672">(</span>default <span style="color:#e6db74">&#34;YOUR NAME&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>          --config string    config file <span style="color:#f92672">(</span>default is $HOME/.cobra.yaml<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      -h, --help             help <span style="color:#66d9ef">for</span> cobra-cli
</span></span><span style="display:flex;"><span>      -l, --license string   name of license <span style="color:#66d9ef">for</span> the project
</span></span><span style="display:flex;"><span>          --viper            use Viper <span style="color:#66d9ef">for</span> configuration
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Use <span style="color:#e6db74">&#34;cobra-cli [command] --help&#34;</span> <span style="color:#66d9ef">for</span> more information about a command.
</span></span></code></pre></div><p>Help 只是一个像其他命令一样的命令。它没有特殊的逻辑或行为。事实上，如果你想的话，你可以提供你自己的help。</p>
<h3 id="help中的命令分组">Help中的命令分组</h3>
<p>Cobra 支持在帮助输出中对可用命令进行分组。要对命令进行分组，每个组都必须显式定义，使用 <code>AddGroup()</code> 方法在父命令上。然后，可以使用该子命令的 <code>GroupID</code> 元素将子命令添加到组中。</p>
<p>这些组将在帮助输出中以与使用不同 <code>AddGroup()</code> 调用定义的顺序相同的顺序出现。</p>
<p>如果您使用生成的 <code>help</code> 或 <code>completion</code> 命令，则可以使用 <code>SetHelpCommandGroupId()</code> 和 <code>SetCompletionCommandGroupId()</code> 方法分别在根命令上设置它们的组 ID。</p>
<h3 id="定义你自己的help">定义你自己的help</h3>
<p>你可以使用以下函数调用你自己的 Help 命令或你自己的模板，供默认命令使用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">SetHelpCommand</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Command</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">SetHelpFunc</span>(<span style="color:#a6e22e">f</span> <span style="color:#66d9ef">func</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">Command</span>, []<span style="color:#66d9ef">string</span>))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">SetHelpTemplate</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>)
</span></span></code></pre></div><p>后两个也将应用于任何子命令。</p>
<h2 id="用法信息">用法信息</h2>
<p>当用户提供无效的flag或无效的命令时，Cobra会通过显示用户的“用法”来做出响应。</p>
<h3 id="例子-1">例子</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    $ cobra-cli --invalid
</span></span><span style="display:flex;"><span>    Error: unknown flag: --invalid
</span></span><span style="display:flex;"><span>    Usage:
</span></span><span style="display:flex;"><span>      cobra-cli <span style="color:#f92672">[</span>command<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Available Commands:
</span></span><span style="display:flex;"><span>      add         Add a command to a Cobra Application
</span></span><span style="display:flex;"><span>      completion  Generate the autocompletion script <span style="color:#66d9ef">for</span> the specified shell
</span></span><span style="display:flex;"><span>      help        Help about any command
</span></span><span style="display:flex;"><span>      init        Initialize a Cobra Application
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Flags:
</span></span><span style="display:flex;"><span>      -a, --author string    author name <span style="color:#66d9ef">for</span> copyright attribution <span style="color:#f92672">(</span>default <span style="color:#e6db74">&#34;YOUR NAME&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>          --config string    config file <span style="color:#f92672">(</span>default is $HOME/.cobra.yaml<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      -h, --help             help <span style="color:#66d9ef">for</span> cobra-cli
</span></span><span style="display:flex;"><span>      -l, --license string   name of license <span style="color:#66d9ef">for</span> the project
</span></span><span style="display:flex;"><span>          --viper            use Viper <span style="color:#66d9ef">for</span> configuration
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Use <span style="color:#e6db74">&#34;cobra [command] --help&#34;</span> <span style="color:#66d9ef">for</span> more information about a command.
</span></span></code></pre></div><h3 id="自定义用法">自定义用法</h3>
<p>你可以为Cobra提供自己的用法函数或模板。与help一样，函数和模板可以通过公共方法进行覆盖：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">SetUsageFunc</span>(<span style="color:#a6e22e">f</span> <span style="color:#66d9ef">func</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">Command</span>) <span style="color:#66d9ef">error</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">SetUsageTemplate</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>)
</span></span></code></pre></div><h2 id="版本flag">版本Flag</h2>
<p>Cobra 会在根命令上设置 Version 字段时添加一个全局标志 <code>--version</code>。</p>
<p>使用 <code>--version</code> 标志运行应用程序将使用版本模板将版本打印到标准输出。可以使用 <code>cmd.SetVersionTemplate(s string)</code> 函数自定义模板。</p>
<h2 id="prerun-和-postrun-钩子">PreRun 和 PostRun 钩子</h2>
<p>可以运行函数在你的命令的主 <code>Run</code> 函数之前或之后。<code>PersistentPreRun</code> 和 <code>PreRun</code> 函数将在 <code>Run</code> 之前执行。<code>PersistentPostRun</code> 和 <code>PostRun</code> 函数将在 <code>Run</code> 之后执行。如果子命令没有声明自己的，则 <code>Persistent*Run</code> 函数将被继承。这些函数按照以下顺序运行</p>
<ul>
<li><code>PersistentPreRun</code></li>
<li><code>PreRun</code></li>
<li><code>Run</code></li>
<li><code>PostRun</code></li>
<li><code>PersistentPostRun</code></li>
</ul>
<p>下面是两个命令的例子，它们使用了所有这些特性。当执行子命令时，它将运行根命令的 <code>PersistentPreRun</code>，但不会运行根命令的 <code>PersistentPostRun</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;github.com/spf13/cobra&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rootCmd</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Use</span>:   <span style="color:#e6db74">&#34;root [sub]&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Short</span>: <span style="color:#e6db74">&#34;My root command&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">PersistentPreRun</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Inside rootCmd PersistentPreRun with args: %v\n&#34;</span>, <span style="color:#a6e22e">args</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">PreRun</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Inside rootCmd PreRun with args: %v\n&#34;</span>, <span style="color:#a6e22e">args</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Inside rootCmd Run with args: %v\n&#34;</span>, <span style="color:#a6e22e">args</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">PostRun</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Inside rootCmd PostRun with args: %v\n&#34;</span>, <span style="color:#a6e22e">args</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">PersistentPostRun</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Inside rootCmd PersistentPostRun with args: %v\n&#34;</span>, <span style="color:#a6e22e">args</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">subCmd</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Use</span>:   <span style="color:#e6db74">&#34;sub [no options!]&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Short</span>: <span style="color:#e6db74">&#34;My subcommand&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">PreRun</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Inside subCmd PreRun with args: %v\n&#34;</span>, <span style="color:#a6e22e">args</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Run</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Inside subCmd Run with args: %v\n&#34;</span>, <span style="color:#a6e22e">args</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">PostRun</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Inside subCmd PostRun with args: %v\n&#34;</span>, <span style="color:#a6e22e">args</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">PersistentPostRun</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Inside subCmd PersistentPostRun with args: %v\n&#34;</span>, <span style="color:#a6e22e">args</span>)
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">AddCommand</span>(<span style="color:#a6e22e">subCmd</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">SetArgs</span>([]<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;&#34;</span>})
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">Execute</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">SetArgs</span>([]<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;sub&#34;</span>, <span style="color:#e6db74">&#34;arg1&#34;</span>, <span style="color:#e6db74">&#34;arg2&#34;</span>})
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rootCmd</span>.<span style="color:#a6e22e">Execute</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Output:</p>
<pre tabindex="0"><code>Inside rootCmd PersistentPreRun with args: []
Inside rootCmd PreRun with args: []
Inside rootCmd Run with args: []
Inside rootCmd PostRun with args: []
Inside rootCmd PersistentPostRun with args: []

Inside rootCmd PersistentPreRun with args: [arg1 arg2]
Inside subCmd PreRun with args: [arg1 arg2]
Inside subCmd Run with args: [arg1 arg2]
Inside subCmd PostRun with args: [arg1 arg2]
Inside subCmd PersistentPostRun with args: [arg1 arg2]
</code></pre><h2 id="当发生未知命令时的提示">当发生“未知命令”时的提示</h2>
<p>Cobra在发生“未知命令”错误时会打印自动建议。这使得Cobra在发生拼写错误时的行为类似于<code>git</code>命令。例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ hugo srever
</span></span><span style="display:flex;"><span>Error: unknown command <span style="color:#e6db74">&#34;srever&#34;</span> <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#34;hugo&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Did you mean this?
</span></span><span style="display:flex;"><span>        server
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Run <span style="color:#e6db74">&#39;hugo --help&#39;</span> <span style="color:#66d9ef">for</span> usage.
</span></span></code></pre></div><p>提示是基于现有的子命令自动生成的，并使用<a href="https://en.wikipedia.org/wiki/Levenshtein_distance">Levenshtein distance</a>的实现。每个注册的命令，如果匹配的最小距离为2（忽略大小写），将被显示为一个提示。</p>
<p>如果您需要在命令中禁用建议或调整字符串距离，请使用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">command</span>.<span style="color:#a6e22e">DisableSuggestions</span> = <span style="color:#66d9ef">true</span>
</span></span></code></pre></div><p>或者</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">command</span>.<span style="color:#a6e22e">SuggestionsMinimumDistance</span> = <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>你可以使用 <code>SuggestFor</code> 属性显式地设置命令将被建议的名称。这允许为在字符串距离方面不接近但在命令集中有意义的字符串提供建议，例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl remove
</span></span><span style="display:flex;"><span>Error: unknown command <span style="color:#e6db74">&#34;remove&#34;</span> <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#34;kubectl&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Did you mean this?
</span></span><span style="display:flex;"><span>        delete
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Run <span style="color:#e6db74">&#39;kubectl help&#39;</span> <span style="color:#66d9ef">for</span> usage.
</span></span></code></pre></div></section>

  
  

  
  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    <a
      class="flex w-1/2 items-center rounded-l-md p-6 pr-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]"
      href="http://localhost:1313/golang/compare-slice/"
      ><span class="mr-1.5">←</span><span>比较 Go 切片的三种高效方法</span></a
    >
    
    
  </nav>
  
  

  
  

  
  

  


  
  <div class="giscus mt-24"></div>
  <script
    src="https://giscus.app/client.js"
    data-repo="haitwang-cloud/haitwang-cloud.github.io"
    data-repo-id="R_kgDOMH03cQ"
    data-category="General"
    data-category-id="DIC_kwDOMH03cc4CgVak"
    data-mapping="pathname"
    data-strict="1"
    data-reactions-enabled="0"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="zh-CN"
    data-loading="lazy"
    crossorigin="anonymous"
    async
  ></script>
  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
>
  <div class="mr-auto">
    &copy; 2024
    <a class="link" href="http://localhost:1313/">Tim Wang Tech Blog</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >Powered by Hugo️️</a
  >️
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >✎ Paper</a
  >
</footer>

  </body>
</html>
