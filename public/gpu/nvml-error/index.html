<!doctype html>




<script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1313460867822205"
     crossorigin="anonymous"></script>





































<html
  class="not-ready lg:text-base"
  style="--bg: #f8f5d7"
  lang="zh-CN"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>å¦‚ä½•è§£å†³ `Failed to initialize NVML: Unknown Error` é—®é¢˜ - Tim Wangçš„æŠ€æœ¯åšå®¢</title>

  
  <meta name="theme-color" />

  
  
  
  
  <meta name="description" content="æœ¬æ–‡æ˜¯NOTICE: Containers losing access to GPUs with error: &ldquo;Failed to initialize NVML: Unknown Error&rdquo;çš„ä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬ï¼Œå†…å®¹æœ‰åˆ å‡ï¼Œäº²æµ‹è¯¥æ–¹æ³•æœ‰æ•ˆã€‚
å¦‚ä½•è§£å†³ Failed to initialize NVML: Unknown Error é—®é¢˜ æ¦‚è¿° åœ¨æŸäº›ç‰¹å®šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‘ç°k8så®¹å™¨å¯èƒ½ä¼šçªç„¶ä»æœ€åˆè¿æ¥åˆ°çš„GPUä¸Šåˆ†ç¦»ã€‚æˆ‘ä»¬å·²ç»ç¡®å®šäº†è¿™ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œå¹¶ç¡®å®šäº†å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µçš„å—å½±å“ç¯å¢ƒã€‚åœ¨æœ¬æ–‡æ¡£çš„æœ«å°¾æä¾›äº†å—å½±å“ç¯å¢ƒçš„è§£å†³æ–¹æ³•ï¼Œç›´åˆ°å‘å¸ƒé€‚å½“çš„ä¿®å¤ä¸ºæ­¢ã€‚
é—®é¢˜æ€»ç»“ æˆ‘ä»¬å‘ç°å½“ä½¿ç”¨containeræ¥ç®¡ç†GPUå·¥ä½œè´Ÿè½½æ—¶ï¼Œç”¨æˆ·containerå¯èƒ½ä¼šçªç„¶å¤±å»å¯¹GPUçš„è®¿é—®æƒé™ã€‚è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨ä½¿ç”¨systemdæ¥ç®¡ç†å®¹å™¨çš„cgroupsæ—¶ï¼Œå½“è§¦å‘é‡æ–°åŠ è½½ä»»ä½•åŒ…å«å¯¹NVIDIA GPUçš„å¼•ç”¨çš„Unitæ–‡ä»¶æ—¶ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡æ‰§è¡Œsystemctl daemon-reloadï¼‰ã€‚
å½“ä½ çš„containerå¤±å»å¯¹GPUçš„è®¿é—®æƒé™æ—¶ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹é”™è¯¯æ¶ˆæ¯ï¼š
Failed to initialize NVML: Unknown Error ä¸€æ—¦å‘ç”Ÿä¸Šè¿° â¬†ï¸ï¼Œå°±éœ€è¦æ‰‹åŠ¨åˆ é™¤å—å½±å“çš„containerï¼Œç„¶åé‡æ–°å¯åŠ¨å®ƒä»¬ã€‚
å½“containeré‡æ–°å¯åŠ¨ï¼ˆæ‰‹åŠ¨æˆ–è‡ªåŠ¨ï¼Œå–å†³äºæ˜¯å¦ä½¿ç”¨å®¹å™¨ç¼–æ’å¹³å°ï¼‰ï¼Œå®ƒå°†é‡æ–°è·å¾—å¯¹GPUçš„è®¿é—®æƒé™ã€‚
æ­¤é—®é¢˜çš„æ ¹æºåœ¨äºï¼Œæœ€è¿‘ç‰ˆæœ¬çš„runcè¦æ±‚åœ¨/dev/charä¸‹é¢ä¸ºæ³¨å…¥åˆ°å®¹å™¨ä¸­çš„ä»»ä½•è®¾å¤‡èŠ‚ç‚¹æä¾›ç¬¦å·é“¾æ¥ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒNVIDIAè®¾å¤‡å¹¶æ²¡æœ‰è¿™äº›ç¬¦å·é“¾æ¥ï¼ŒNVIDIA GPUé©±åŠ¨ä¹Ÿæ²¡æœ‰ï¼ˆå½“å‰ï¼‰æä¾›è‡ªåŠ¨åˆ›å»ºè¿™äº›é“¾æ¥çš„æ–¹æ³•
å—å½±å“çš„ç¯å¢ƒ å¦‚æœä½ ä½¿ç”¨runcå¹¶åœ¨é«˜çº§å®¹å™¨è¿è¡Œæ—¶ï¼ˆCRIï¼‰å¯ç”¨systemd cgroupç®¡ç†çš„ç¯å¢ƒï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šå—åˆ°è¿™ä¸ªé—®é¢˜çš„å½±å“
å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨systemdæ¥ç®¡ç†cgroupï¼Œé‚£ä¹ˆå®ƒå°±ä¸ä¼šå—åˆ°è¿™ä¸ªé—®é¢˜çš„å½±å“ã€‚ ä¸‹é¢æ˜¯å¯èƒ½ä¼šå—å½±å“çš„çš„ç¯å¢ƒçš„è¯¦å°½åˆ—è¡¨:
ä½¿ç”¨containerd/runcçš„Dockerç¯å¢ƒ ç‰¹å®šæ¡ä»¶ å¯ç”¨äº†systemdçš„cgroupé©±åŠ¨ç¨‹åºï¼ˆä¾‹å¦‚ï¼Œåœ¨/etc/docker/daemon.jsonä¸­è®¾ç½®äº†å‚æ•°&quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]ï¼‰ ä½¿ç”¨äº†æ›´æ–°çš„Dockerç‰ˆæœ¬ï¼Œå…¶ä¸­systemd cgroupç®¡ç†è¢«é»˜è®¤è®¾ç½®çš„ï¼ˆå³ï¼Œåœ¨Ubuntu 22.04ä¸Šï¼‰ã€‚ Noteå¦‚æœä½ è¦æ£€æŸ¥Dockeræ˜¯å¦ä½¿ç”¨systemd cgroupç®¡ç†ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆä¸‹é¢çš„è¾“å‡ºè¡¨ç¤ºå¯ç”¨äº†systemd cgroupé©±åŠ¨ç¨‹åºï¼‰
$ docker info ... Cgroup Driver: systemd Cgroup Version: 1 ä½¿ç”¨containerd/runcçš„Kubernetesç¯å¢ƒ ç‰¹å®šæ¡ä»¶ åœ¨containerdé…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸ä½äºï¼š/etc/containerd/config.tomlï¼‰ä¸­è®¾ç½®SystemdCgroup = trueï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š [plugins." />
  <meta name="author" content="Tim Wang" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="http://localhost:1313/main.min.css" />

  
  
  
  
  
  <link rel="preload" as="image" href="http://localhost:1313/theme.png" />

  
  
  
  
  <link rel="preload" as="image" href="https://gravatar.com/haitaoking1993" />
  
  

  
  
  <link rel="preload" as="image" href="http://localhost:1313/github.svg" />
  
  <link rel="preload" as="image" href="http://localhost:1313/linkedin.svg" />
  
  <link rel="preload" as="image" href="http://localhost:1313/rss.svg" />
  
  

  
  
  <script
    defer
    src="http://localhost:1313/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  
  

  
  <link rel="icon" href="http://localhost:1313/favicon.ico" />
  <link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.127.0">

  
  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold"
      href="http://localhost:1313/"
      >Tim Wangçš„æŠ€æœ¯åšå®¢</a
    >
    <div
      class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  

  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#f8f5d7'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    
    <nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6">
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/istio/"
        >Istio</a
      >
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/k8s/"
        >K8s</a
      >
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/gpu/"
        >GPU</a
      >
      
    </nav>
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href="https://github.com/haitwang-cloud"
        target="_blank"
        rel="me"
      >
        github
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./linkedin.svg)"
        href="https://linkedin.com/in/tim-wang-505213166"
        target="_blank"
        rel="me"
      >
        linkedin
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./rss.svg)"
        href="http://localhost:1313/index.xml"
        target="_blank"
        rel="alternate"
      >
        rss
      </a>
      
    </nav>
    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"
    >
      

<article>
  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">å¦‚ä½•è§£å†³ `Failed to initialize NVML: Unknown Error` é—®é¢˜</h1>

    
    <div class="text-sm antialiased opacity-60">
      
      <time>Jun 14, 2024</time>
      
      
      
      
    </div>
    
  </header>

  <section><blockquote>
<p>æœ¬æ–‡æ˜¯<a href="https://github.com/NVIDIA/nvidia-container-toolkit/issues/48">NOTICE: Containers losing access to GPUs with error: &ldquo;Failed to initialize NVML: Unknown Error&rdquo;</a>çš„ä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬ï¼Œå†…å®¹æœ‰åˆ å‡ï¼Œäº²æµ‹è¯¥æ–¹æ³•æœ‰æ•ˆã€‚</p>
</blockquote>
<h1 id="å¦‚ä½•è§£å†³-failed-to-initialize-nvml-unknown-error-é—®é¢˜">å¦‚ä½•è§£å†³ <code>Failed to initialize NVML: Unknown Error</code> é—®é¢˜</h1>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>åœ¨æŸäº›ç‰¹å®šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‘ç°k8så®¹å™¨å¯èƒ½ä¼šçªç„¶ä»æœ€åˆè¿æ¥åˆ°çš„GPUä¸Šåˆ†ç¦»ã€‚æˆ‘ä»¬å·²ç»ç¡®å®šäº†è¿™ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œå¹¶ç¡®å®šäº†å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µçš„å—å½±å“ç¯å¢ƒã€‚åœ¨æœ¬æ–‡æ¡£çš„æœ«å°¾æä¾›äº†å—å½±å“ç¯å¢ƒçš„è§£å†³æ–¹æ³•ï¼Œç›´åˆ°å‘å¸ƒé€‚å½“çš„ä¿®å¤ä¸ºæ­¢ã€‚</p>
<h2 id="é—®é¢˜æ€»ç»“">é—®é¢˜æ€»ç»“</h2>
<p>æˆ‘ä»¬å‘ç°å½“ä½¿ç”¨containeræ¥ç®¡ç†GPUå·¥ä½œè´Ÿè½½æ—¶ï¼Œç”¨æˆ·containerå¯èƒ½ä¼šçªç„¶å¤±å»å¯¹GPUçš„è®¿é—®æƒé™ã€‚è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨ä½¿ç”¨systemdæ¥ç®¡ç†å®¹å™¨çš„cgroupsæ—¶ï¼Œå½“è§¦å‘é‡æ–°åŠ è½½ä»»ä½•åŒ…å«å¯¹NVIDIA GPUçš„å¼•ç”¨çš„Unitæ–‡ä»¶æ—¶ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡æ‰§è¡Œ<code>systemctl daemon-reload</code>ï¼‰ã€‚</p>
<p>å½“ä½ çš„containerå¤±å»å¯¹GPUçš„è®¿é—®æƒé™æ—¶ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹é”™è¯¯æ¶ˆæ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Failed to initialize NVML: Unknown Error
</span></span></code></pre></div><p>ä¸€æ—¦å‘ç”Ÿä¸Šè¿° â¬†ï¸ï¼Œå°±éœ€è¦æ‰‹åŠ¨åˆ é™¤å—å½±å“çš„containerï¼Œç„¶åé‡æ–°å¯åŠ¨å®ƒä»¬ã€‚</p>
<p>å½“containeré‡æ–°å¯åŠ¨ï¼ˆæ‰‹åŠ¨æˆ–è‡ªåŠ¨ï¼Œå–å†³äºæ˜¯å¦ä½¿ç”¨å®¹å™¨ç¼–æ’å¹³å°ï¼‰ï¼Œå®ƒå°†é‡æ–°è·å¾—å¯¹GPUçš„è®¿é—®æƒé™ã€‚</p>
<p>æ­¤é—®é¢˜çš„æ ¹æºåœ¨äºï¼Œæœ€è¿‘ç‰ˆæœ¬çš„<code>runc</code>è¦æ±‚åœ¨<code>/dev/char</code>ä¸‹é¢ä¸ºæ³¨å…¥åˆ°å®¹å™¨ä¸­çš„ä»»ä½•è®¾å¤‡èŠ‚ç‚¹æä¾›ç¬¦å·é“¾æ¥ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒNVIDIAè®¾å¤‡å¹¶æ²¡æœ‰è¿™äº›ç¬¦å·é“¾æ¥ï¼ŒNVIDIA GPUé©±åŠ¨ä¹Ÿæ²¡æœ‰ï¼ˆå½“å‰ï¼‰æä¾›è‡ªåŠ¨åˆ›å»ºè¿™äº›é“¾æ¥çš„æ–¹æ³•</p>
<h2 id="å—å½±å“çš„ç¯å¢ƒ">å—å½±å“çš„ç¯å¢ƒ</h2>
<p><strong>å¦‚æœä½ ä½¿ç”¨<code>runc</code>å¹¶åœ¨é«˜çº§å®¹å™¨è¿è¡Œæ—¶ï¼ˆCRIï¼‰å¯ç”¨<code>systemd cgroup</code>ç®¡ç†çš„ç¯å¢ƒï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šå—åˆ°è¿™ä¸ªé—®é¢˜çš„å½±å“</strong></p>
<p>å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨<code>systemd</code>æ¥ç®¡ç†<code>cgroup</code>ï¼Œé‚£ä¹ˆå®ƒå°±ä¸ä¼šå—åˆ°è¿™ä¸ªé—®é¢˜çš„å½±å“ã€‚
ä¸‹é¢æ˜¯å¯èƒ½ä¼šå—å½±å“çš„çš„ç¯å¢ƒçš„è¯¦å°½åˆ—è¡¨:</p>
<h3 id="ä½¿ç”¨containerdruncçš„dockerç¯å¢ƒ">ä½¿ç”¨<code>containerd</code>/<code>runc</code>çš„Dockerç¯å¢ƒ</h3>
<h4 id="ç‰¹å®šæ¡ä»¶">ç‰¹å®šæ¡ä»¶</h4>
<ul>
<li>å¯ç”¨äº†<code>systemd</code>çš„<code>cgroup</code>é©±åŠ¨ç¨‹åºï¼ˆä¾‹å¦‚ï¼Œåœ¨<code>/etc/docker/daemon.json</code>ä¸­è®¾ç½®äº†å‚æ•°<code>&quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]</code>ï¼‰</li>
<li>ä½¿ç”¨äº†æ›´æ–°çš„<code>Docker</code>ç‰ˆæœ¬ï¼Œå…¶ä¸­<code>systemd cgroup</code>ç®¡ç†è¢«é»˜è®¤è®¾ç½®çš„ï¼ˆå³ï¼Œåœ¨Ubuntu 22.04ä¸Šï¼‰ã€‚</li>
</ul>
<blockquote>
<p><code>Note</code>å¦‚æœä½ è¦æ£€æŸ¥<code>Docker</code>æ˜¯å¦ä½¿ç”¨<code>systemd cgroup</code>ç®¡ç†ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆä¸‹é¢çš„è¾“å‡ºè¡¨ç¤ºå¯ç”¨äº†<code>systemd cgroup</code>é©±åŠ¨ç¨‹åºï¼‰</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span> $ docker info  
</span></span><span style="display:flex;"><span> ...  
</span></span><span style="display:flex;"><span> Cgroup Driver: systemd  
</span></span><span style="display:flex;"><span> Cgroup Version: <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><h3 id="ä½¿ç”¨containerdruncçš„kubernetesç¯å¢ƒ">ä½¿ç”¨<code>containerd</code>/<code>runc</code>çš„Kubernetesç¯å¢ƒ</h3>
<h4 id="ç‰¹å®šæ¡ä»¶-1">ç‰¹å®šæ¡ä»¶</h4>
<ul>
<li>åœ¨<code>containerd</code>é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸ä½äºï¼š<code>/etc/containerd/config.toml</code>ï¼‰ä¸­è®¾ç½®<code>SystemdCgroup = true</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>plugins.<span style="color:#e6db74">&#34;io.containerd.grpc.v1.cri&#34;</span>.containerd.runtimes.nvidia.options<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>BinaryName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/usr/local/nvidia/toolkit/nvidia-container-runtime&#34;</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>SystemdCgroup <span style="color:#f92672">=</span> true
</span></span></code></pre></div><blockquote>
<p>Note:å¦‚æœä½ æƒ³è¦æ£€æŸ¥<code>containerd</code>æ˜¯å¦ä½¿ç”¨<code>systemd cgroup</code>ç®¡ç†ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆä¸‹é¢çš„è¾“å‡ºè¡¨ç¤ºå¯ç”¨äº†<code>systemd cgroup</code>é©±åŠ¨ç¨‹åºï¼‰</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo crictl info  
</span></span><span style="display:flex;"><span>...  
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;runtimes&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;nvidia&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;runtimeType&#34;</span>: <span style="color:#e6db74">&#34;io.containerd.runc.v2&#34;</span>,
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;options&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;BinaryName&#34;</span>: <span style="color:#e6db74">&#34;/usr/local/nvidia/toolkit/nvidia-container-runtime&#34;</span>,
</span></span><span style="display:flex;"><span>          ...
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;ShimCgroup&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;SystemdCgroup&#34;</span>: true
</span></span></code></pre></div><h3 id="ä½¿ç”¨cri-oruncçš„kubernetesç¯å¢ƒ">ä½¿ç”¨<code>cri-o</code>/<code>runc</code>çš„Kubernetesç¯å¢ƒ</h3>
<h4 id="ç‰¹å®šæ¡ä»¶-2">ç‰¹å®šæ¡ä»¶</h4>
<p>åœ¨<code>cri-o</code>é…ç½®æ–‡ä»¶ä¸­å¯ç”¨äº†<code>systemd</code>çš„<code>cgroup_manager</code>ï¼ˆé€šå¸¸ä½äºï¼š<code>/etc/crio/crio.confæˆ–/etc/crio/crio.conf.d/00-default</code>ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼ˆä½¿ç”¨<code>OpenShift</code>çš„ç¤ºä¾‹ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>crio.runtime<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>cgroup_manager <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;systemd&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>hooks_dir <span style="color:#f92672">=</span> <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;/etc/containers/oci/hooks.d&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;/run/containers/oci/hooks.d&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;/usr/share/containers/oci/hooks.d&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Note: <code>Podman</code>ç¯å¢ƒé»˜è®¤ä½¿ç”¨<code>crun</code>ï¼Œå¹¶ä¸”é™¤éåˆ»æ„å°†<code>runc</code>é…ç½®ä¸ºè¦ä½¿ç”¨çš„åº•å±‚å®¹å™¨è¿è¡ŒCRIæ—¶ï¼Œå¦åˆ™ä¸ä¼šå—åˆ°è¿™ä¸ªé—®é¢˜çš„å½±å“ã€‚</p>
<h2 id="å¦‚ä½•æ£€æŸ¥ä½ çš„ç¯å¢ƒæ˜¯å¦å—åˆ°å½±å“">å¦‚ä½•æ£€æŸ¥ä½ çš„ç¯å¢ƒæ˜¯å¦å—åˆ°å½±å“</h2>
<p>æ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ç¡®è®¤æ‚¨çš„ç³»ç»Ÿæ˜¯å¦å—åˆ°å½±å“ã€‚æ‚¨å¯ä»¥è¿™äº›æ­¥éª¤æ¥ç¡®è®¤é”™è¯¯æ˜¯å¦å¯ä»¥å¤ç°ã€‚</p>
<h3 id="dockerç¯å¢ƒ">Dockerç¯å¢ƒ</h3>
<p>è¿è¡Œä¸€ä¸ªæµ‹è¯•çš„<code>container</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -d --rm --runtime<span style="color:#f92672">=</span>nvidia --gpus all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --device<span style="color:#f92672">=</span>/dev/nvidia-uvm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --device<span style="color:#f92672">=</span>/dev/nvidia-uvm-tools <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --device<span style="color:#f92672">=</span>/dev/nvidia-modeset <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --device<span style="color:#f92672">=</span>/dev/nvidiactl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --device<span style="color:#f92672">=</span>/dev/nvidia0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    nvcr.io/nvidia/cuda:12.0.0-base-ubuntu20.04 bash -c <span style="color:#e6db74">&#34;while [ true ]; do nvidia-smi -L; sleep 5; done&#34;</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bc045274b44bdf6ec2e4cc10d2968d1d2a046c47cad0a1d2088dc0a430add24b
</span></span></code></pre></div><blockquote>
<p>Note è¯·ç¡®ä¿ä½ æµ‹è¯•çš„<code>container</code>æŒ‚è½½ä¸åŒçš„è®¾å¤‡ï¼ˆå¦‚ä¸Šæ‰€ç¤ºï¼‰ã€‚è¿™æ˜¯ç¡®å®šæ­¤ç‰¹å®šé—®é¢˜çš„å¿…è¦æ¡ä»¶ã€‚</p>
</blockquote>
<p>å¦‚æœæ‚¨çš„ç³»ç»Ÿæœ‰è¶…è¿‡1ä¸ªGPUï¼Œè¯·åœ¨ä¸Šè¿°å‘½ä»¤åé™„åŠ é¢å¤–çš„ &ndash;device æŒ‚è½½ã€‚æ‹¥æœ‰2ä¸ªGPUçš„ç³»ç»Ÿçš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -d --rm --runtime<span style="color:#f92672">=</span>nvidia --gpus all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    ...
</span></span><span style="display:flex;"><span>    --device<span style="color:#f92672">=</span>/dev/nvidia0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --device<span style="color:#f92672">=</span>/dev/nvidia1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    ...
</span></span></code></pre></div><p>æ­¤æ—¶å¯ä»¥æŸ¥çœ‹<code>container</code>çš„log</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker logs bc045274b44bdf6ec2e4cc10d2968d1d2a046c47cad0a1d2088dc0a430add24b
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GPU 0: Tesla K80 <span style="color:#f92672">(</span>UUID: GPU-05ea3312-64dd-a4e7-bc72-46d2f6050147<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>GPU 0: Tesla K80 <span style="color:#f92672">(</span>UUID: GPU-05ea3312-64dd-a4e7-bc72-46d2f6050147<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>ç„¶åä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è§¦å‘ <code>daemon-reload</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo systemctl daemon-reload
</span></span></code></pre></div><p>æ­¤æ—¶å†æ¬¡æŸ¥çœ‹<code>container</code>çš„log, æˆ‘ä»¬å¯ä»¥å¤ç°è¿™ä¸ªé—®é¢˜</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker logs bc045274b44bdf6ec2e4cc10d2968d1d2a046c47cad0a1d2088dc0a430add24b
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GPU 0: Tesla K80 <span style="color:#f92672">(</span>UUID: GPU-05ea3312-64dd-a4e7-bc72-46d2f6050147<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>GPU 0: Tesla K80 <span style="color:#f92672">(</span>UUID: GPU-05ea3312-64dd-a4e7-bc72-46d2f6050147<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>GPU 0: Tesla K80 <span style="color:#f92672">(</span>UUID: GPU-05ea3312-64dd-a4e7-bc72-46d2f6050147<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>GPU 0: Tesla K80 <span style="color:#f92672">(</span>UUID: GPU-05ea3312-64dd-a4e7-bc72-46d2f6050147<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Failed to initialize NVML: Unknown Error
</span></span><span style="display:flex;"><span>Failed to initialize NVML: Unknown Error
</span></span></code></pre></div><h3 id="k8s-ç¯å¢ƒ">K8s ç¯å¢ƒ</h3>
<p>è¿è¡Œä¸€ä¸ªæµ‹è¯•çš„<code>Pod</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat nvidia-smi-loop.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Pod
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: cuda-nvidia-smi-loop
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  restartPolicy: OnFailure
</span></span><span style="display:flex;"><span>  containers:
</span></span><span style="display:flex;"><span>  - name: cuda
</span></span><span style="display:flex;"><span>    image: <span style="color:#e6db74">&#34;nvcr.io/nvidia/cuda:12.0.0-base-ubuntu20.04&#34;</span>
</span></span><span style="display:flex;"><span>    command: <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/bin/sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    args: <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;while true; do nvidia-smi -L; sleep 5; done&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    resources:
</span></span><span style="display:flex;"><span>      limits:
</span></span><span style="display:flex;"><span>        nvidia.com/gpu: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f nvidia-smi-loop.yaml  
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>pod/cuda-nvidia-smi-loop created
</span></span></code></pre></div><p>æ­¤æ—¶å¯ä»¥æŸ¥çœ‹<code>Pod</code>çš„log</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl logs cuda-nvidia-smi-loop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GPU 0: NVIDIA A100-PCIE-40GB <span style="color:#f92672">(</span>UUID: GPU-551720f0-caf0-22b7-f525-2a51a6ab478d<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>GPU 0: NVIDIA A100-PCIE-40GB <span style="color:#f92672">(</span>UUID: GPU-551720f0-caf0-22b7-f525-2a51a6ab478d<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>ç„¶åä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è§¦å‘ <code>daemon-reload</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo systemctl daemon-reload
</span></span></code></pre></div><p>æ­¤æ—¶å†æ¬¡æŸ¥çœ‹<code>Pod</code>çš„log, æˆ‘ä»¬å¯ä»¥å¤ç°è¿™ä¸ªé—®é¢˜</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl logs cuda-nvidia-smi-loop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GPU 0: NVIDIA A100-PCIE-40GB <span style="color:#f92672">(</span>UUID: GPU-551720f0-caf0-22b7-f525-2a51a6ab478d<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>GPU 0: NVIDIA A100-PCIE-40GB <span style="color:#f92672">(</span>UUID: GPU-551720f0-caf0-22b7-f525-2a51a6ab478d<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Failed to initialize NVML: Unknown Error
</span></span><span style="display:flex;"><span>Failed to initialize NVML: Unknown Error
</span></span></code></pre></div><h2 id="workarounds">Workarounds</h2>
<p>ä¸‹é¢çš„è§£å†³æ–¹æ³•é€‚ç”¨äºç‹¬ç«‹çš„dockerç¯å¢ƒå’Œk8sç¯å¢ƒï¼ˆæŒ‰ç…§æ¨èé¡ºåºğŸ‘æä¾›å¤šä¸ªé€‰é¡¹ï¼›æœ€æ¨èğŸ‘çš„é€‰é¡¹åœ¨æœ€ä¸Šé¢ï¼‰ï¼š</p>
<h3 id="dockerç¯å¢ƒ-1">Dockerç¯å¢ƒ</h3>
<h4 id="ä½¿ç”¨nvidia-ctkå·¥å…·">ä½¿ç”¨<code>nvidia-ctk</code>å·¥å…·:</h4>
<p>NVIDIA Container Toolkit v1.12.0åŒ…å«äº†ä¸€ä¸ªåœ¨<code>/dev/char</code>ä¸­ä¸ºæ‰€æœ‰å¯èƒ½çš„NVIDIAè®¾å¤‡èŠ‚ç‚¹åˆ›å»ºç¬¦å·é“¾æ¥çš„å·¥å…·ï¼Œè¿™äº›èŠ‚ç‚¹å¯¹äºåœ¨å®¹å™¨ä¸­ä½¿ç”¨GPUæ˜¯å¿…è¦çš„ã€‚è¯¥å·¥å…·å¯ä»¥å¦‚ä¸‹è¿è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo nvidia-ctk system create-dev-char-symlinks <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --create-all
</span></span></code></pre></div><p>è¿™ä¸ªå‘½ä»¤åº”è¯¥åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„å¯åŠ¨æ—¶è¿è¡Œï¼Œè¿™æ ·å®¹å™¨ä¸­ä½¿ç”¨GPUæ—¶å°±ä¸ä¼šå‡ºç°é—®é¢˜ã€‚åœ¨è¿è¡Œè¿™ä¸ªå‘½ä»¤ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿NVIDIAé©±åŠ¨çš„å†…æ ¸æ¨¡å—å·²ç»åŠ è½½ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„<code>udev</code>è§„åˆ™å¯ä»¥å¼ºåˆ¶æ‰§è¡Œè¿™ä¸€ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># This will create /dev/char symlinks to all device nodes</span>
</span></span><span style="display:flex;"><span>ACTION<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;add&#34;</span>, DEVPATH<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;/bus/pci/drivers/nvidia&#34;</span>, RUN<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;/usr/bin/nvidia-ctk system 	create-dev-char-symlinks --create-all&#34;</span>
</span></span></code></pre></div><p>å®‰è£…æ­¤è§„åˆ™çš„æ¨èçš„åœ°æ–¹æ˜¯ï¼š<code>/lib/udev/rules.d/71-nvidia-dev-char.rules</code></p>
<p>åœ¨ä½¿ç”¨<code>NVIDIA GPU Driver Container</code>çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»æŒ‡å®šé©±åŠ¨ç¨‹åºå®‰è£…çš„è·¯å¾„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‘½ä»¤åº”è¯¥ä¿®æ”¹ä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo nvidia-ctk system create-dev-symlinks <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --create-all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --driver-root<span style="color:#f92672">={{</span>NVIDIA_DRIVER_ROOT<span style="color:#f92672">}}</span>
</span></span></code></pre></div><p><code>{{NVIDIA_DRIVER_ROOT}}</code>æ˜¯NVIDIA GPU Driver containerå®‰è£…NVIDIA GPUé©±åŠ¨ç¨‹åºå¹¶åˆ›å»ºNVIDIAè®¾å¤‡èŠ‚ç‚¹çš„è·¯å¾„ã€‚</p>
<h4 id="éšå¼åœ°ç¦ç”¨dockerä¸­çš„systemd-cgroupç®¡ç†">éšå¼åœ°ç¦ç”¨Dockerä¸­çš„<code>systemd cgroup</code>ç®¡ç†</h4>
<p>è®¾ç½®<code>/etc/docker/daemon.json</code>æ–‡ä»¶ä¸­çš„å‚æ•°<code>&quot;exec-opts&quot;: [&quot;native.cgroupdriver=cgroupfs&quot;]</code>å¹¶é‡å¯dockerã€‚</p>
<h4 id="é™çº§dockerio">é™çº§docker.io</h4>
<p>é™çº§åˆ°<code>docker.io</code>åŒ…ï¼Œå…¶ä¸­<code>systemd</code>ä¸æ˜¯é»˜è®¤çš„<code>cgroup</code>ç®¡ç†å™¨ï¼ˆå½“ç„¶ä¸è¦è¦†ç›–ï¼‰ã€‚</p>
<h3 id="k8s-ç¯å¢ƒ-1">K8s ç¯å¢ƒ</h3>
<h4 id="gpu-operator">GPU Operator</h4>
<p>ä½ å¯ä»¥ä½¿ç”¨<code>GPU Operator</code>çš„<code>22.9.2</code>ä»¥åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå®ƒä¼šè‡ªåŠ¨ä¿®å¤é›†ç¾¤ä¸­æ‰€æœ‰K8sèŠ‚ç‚¹ä¸Šçš„é—®é¢˜ï¼ˆæ­¤ä¿®å¤å·²ç»é›†æˆåˆ°<a href="https://github.com/NVIDIA/gpu-operator/tree/master/validator">gpu-operator-validator</a>ä¸­ï¼Œå½“æ–°Nodeéƒ¨ç½²æˆ–æ¯æ¬¡Nodeé‡å¯æ—¶éƒ½ä¼šè¿è¡Œï¼‰ã€‚</p>
<h4 id="k8s-device-plugin">k8s-device-plugin</h4>
<p>å¯¹äºç›´æ¥ä½¿ç”¨k8s-device-pluginçš„åœºæ™¯æ¥è¯´ï¼ˆå³ä¸é€šè¿‡<code>GPU Operator</code>ä½¿ç”¨ï¼‰ï¼Œä½ å¯ä»¥å®‰è£…å¦‚ä¸Šä¸€èŠ‚æ‰€è¿°çš„<code>udev</code>è§„åˆ™æ¥è§£å†³æ­¤é—®é¢˜ã€‚ã€‚å¦‚æœä½ ä½¿ç”¨äº†containeræ¥å®‰è£…driverçš„è¯ï¼Œè¯·è¯·ç¡®ä¿ä¼ é€’æ­£ç¡®çš„<code>{{NVIDIA_DRIVER_ROOT}}</code>ã€‚è¯¦æƒ…è¯·å‚è€ƒ<a href="https://github.com/NVIDIA/k8s-device-plugin?tab=readme-ov-file#configuration-option-details">configuration-option-details in k8s-device-plugin</a></p>
<h4 id="åœ¨containerdæˆ–cri-oéšå¼åœ°ç¦ç”¨systemd-cgroup">åœ¨<code>containerd</code>æˆ–<code>cri-o</code>éšå¼åœ°ç¦ç”¨<code>systemd cgroup</code></h4>
<p>ä»cri-oé…ç½®æ–‡ä»¶ä¸­åˆ é™¤å‚æ•°<code>cgroup_manager = &quot;systemd&quot;</code>ï¼ˆé€šå¸¸ä½äºï¼š<code>/etc/crio/crio.conf</code>æˆ–<code>/etc/crio/crio.conf.d/00-default</code>ï¼‰ï¼Œç„¶åé‡å¯cri-oã€‚</p>
<h4 id="é™çº§containerd">é™çº§<code>containerd</code></h4>
<p>é™çº§åˆ°<code>containerd.io</code>åŒ…çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå…¶ä¸­<code>systemd</code>ä¸æ˜¯é»˜è®¤çš„<code>cgroup</code>ç®¡ç†å™¨ï¼ˆå½“ç„¶ä¸è¦è¦†ç›–ï¼‰ã€‚</p>
<h2 id="ç›¸å…³é—®é¢˜é“¾æ¥">ç›¸å…³é—®é¢˜é“¾æ¥ğŸ”—</h2>
<ul>
<li><a href="https://github.com/NVIDIA/nvidia-docker/issues/1671">&ldquo;Failed to initialize NVML: Unknown Error&rdquo; after random amount of time</a></li>
<li><a href="https://github.com/NVIDIA/nvidia-docker/issues/1730">NOTICE: Containers losing access to GPUs with error: &ldquo;Failed to initialize NVML: Unknown Error&rdquo; </a></li>
<li><a href="https://github.com/NVIDIA/nvidia-docker/issues/966#issuecomment-610928514">Updating cpu-manager-policy=static causes NVML unknown error</a></li>
</ul>
</section>

  
  

  
  
  
  
  

  
  

  
  

  


  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
>
  <div class="mr-auto">
    &copy; 2024
    <a class="link" href="http://localhost:1313/">Tim Wangçš„æŠ€æœ¯åšå®¢</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >Powered by Hugoï¸ï¸</a
  >ï¸
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >âœ Paper</a
  >
</footer>

  </body>
</html>
