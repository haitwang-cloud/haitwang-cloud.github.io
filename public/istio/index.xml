<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Istio on Tim Wang Tech Blog</title>
    <link>http://localhost:1313/istio/</link>
    <description>Recent content in Istio on Tim Wang Tech Blog</description>
    <generator>Hugo</generator>
    <language>zh-CN</language>
    <lastBuildDate>Tue, 09 Jul 2024 09:55:49 +0800</lastBuildDate>
    <atom:link href="http://localhost:1313/istio/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Resolving Memory Error in Istioctl Analyze Command</title>
      <link>http://localhost:1313/istio/istioctl-analyze-error-en/</link>
      <pubDate>Tue, 09 Jul 2024 09:55:49 +0800</pubDate>
      <guid>http://localhost:1313/istio/istioctl-analyze-error-en/</guid>
      <description>Problem Description Recently, while using the istioctl analyze -A command to analyze Istio configurations, we encountered a perplexing error:&#xA;panic: runtime error: invalid memory address or nil pointer dereference [signal SIGSEGV: segmentation violation code=0x2 addr=0x90 pc=0x104d85f9c] goroutine 1 [running]: istio.io/istio/pkg/config/analysis/analyzers/authz.(*AuthorizationPoliciesAnalyzer).analyzeNamespaceNotFound(0x140080985a0?, 0x140080985a0, {0x105ed1480, 0x140066a7c20?}) istio.io/istio/pkg/config/analysis/analyzers/authz/authorizationpolicies.go:145 +0xdc ... The error log indicates that the AuthorizationPoliciesAnalyzer.analyzeNamespaceNotFound function triggered a panic when handling a scenario where a namespace couldn&amp;rsquo;t be found.&#xA;Introduction to Istioctl Analyze Istio is a popular service mesh solution, and istioctl is its command-line tool.</description>
    </item>
    <item>
      <title>å¦‚ä½•è§£å†³ Istioctl Analyze -A å‘½ä»¤æŠ¥invalid memory addressé—®é¢˜</title>
      <link>http://localhost:1313/istio/istioctl-analyze-error/</link>
      <pubDate>Mon, 08 Jul 2024 16:47:07 +0800</pubDate>
      <guid>http://localhost:1313/istio/istioctl-analyze-error/</guid>
      <description>é—®é¢˜æè¿° æœ€è¿‘æˆ‘åœ¨å°è¯•ç”¨ Istioctl Analyze -Aæ¥å¯¹æ•´ä½“çš„Istioé…ç½®è¿›è¡Œåˆ†æï¼Œä½†æ˜¯åœ¨æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œæˆ‘é‡åˆ°äº†å¦‚ä¸‹é”™è¯¯ï¼š&#xA;panic: runtime error: invalid memory address or nil pointer dereference [signal SIGSEGV: segmentation violation code=0x2 addr=0x90 pc=0x104d85f9c] goroutine 1 [running]: istio.io/istio/pkg/config/analysis/analyzers/authz.(*AuthorizationPoliciesAnalyzer).analyzeNamespaceNotFound(0x140080985a0?, 0x140080985a0, {0x105ed1480, 0x140066a7c20?}) istio.io/istio/pkg/config/analysis/analyzers/authz/authorizationpolicies.go:145 +0xdc istio.io/istio/pkg/config/analysis/analyzers/authz.(*AuthorizationPoliciesAnalyzer).Analyze.func1(0x104f6cdda?) istio.io/istio/pkg/config/analysis/analyzers/authz/authorizationpolicies.go:59 +0x58 istio.io/istio/pkg/config/analysis/local.(*istiodContext).ForEach(0x140066a7c20, {{0x104f6cdda, 0x11}, {0x104f5243f, 0x7}, {0x104f72cd1, 0x13}}, 0x14006897980) istio.io/istio/pkg/config/analysis/local/context.go:168 +0x574 istio.io/istio/pkg/config/analysis/analyzers/authz.(*AuthorizationPoliciesAnalyzer).Analyze(0x107d30e20, {0x105ed1480?, 0x140066a7c20}) istio.io/istio/pkg/config/analysis/analyzers/authz/authorizationpolicies.go:57 +0xf0 istio.io/istio/pkg/config/analysis.(*CombinedAnalyzer).Analyze(0x14000cbe6c0, {0x105ed1480, 0x140066a7c20}) istio.io/istio/pkg/config/analysis/analyzer.go:75 +0xcc istio.io/istio/pkg/config/analysis/local.(*IstiodAnalyzer).internalAnalyze(0x14000a7ec30, 0x1400007faa0?, 0x1400007faa0) istio.io/istio/pkg/config/analysis/local/istiod_analyze.go:146 +0x244 istio.io/istio/pkg/config/analysis/local.(*IstiodAnalyzer).ReAnalyze(...) istio.io/istio/pkg/config/analysis/local/istiod_analyze.go:131 istio.io/istio/pkg/config/analysis/local.(*IstiodAnalyzer).Analyze(0x14000a7ec30, 0x105ee1ee8?) istio.io/istio/pkg/config/analysis/local/istiod_analyze.go:171 +0xac istio.io/istio/istioctl/pkg/analyze.Analyze.func1(0x14000d6f200?, {0x140008e8020, 0x0, 0x2}) istio.io/istio/istioctl/pkg/analyze/analyze.go:229 +0xb74 github.</description>
    </item>
    <item>
      <title>æ·±å…¥ç†è§£Istioï¼šç½‘ç»œåŸç†ä¸Sidecarçš„è‡ªåŠ¨æ³¨å…¥æœºåˆ¶</title>
      <link>http://localhost:1313/istio/istio-sidecar-inject/</link>
      <pubDate>Thu, 20 Jun 2024 16:24:32 +0800</pubDate>
      <guid>http://localhost:1313/istio/istio-sidecar-inject/</guid>
      <description>Istio ç®€ä»‹ Istioï¼Œä½œä¸ºä¸€æ¬¾æœåŠ¡ç½‘æ ¼é¢†åŸŸçš„ä½¼ä½¼è€…ï¼Œä¸ºå¾®æœåŠ¡æ¶æ„æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„ç½‘ç»œèƒ½åŠ›ã€‚ æœ¬æ–‡æ—¨åœ¨æ·±å…¥æ¢è®¨Istioçš„ç½‘ç»œåŸç†ï¼Œæ­ç¤ºå…¶å¦‚ä½•åœ¨å¤æ‚çš„æœåŠ¡é—´é€šä¿¡ä¸­å‘æŒ¥å…³é”®ä½œç”¨ï¼ŒåŒæ—¶ä¿æŒé«˜å¯è§‚å¯Ÿæ€§å’Œå®‰å…¨æ€§ã€‚&#xA;Istio çš„æ ¸å¿ƒåœ¨äºå…¶æœåŠ¡ç½‘æ ¼æ¨¡å‹ï¼Œå®ƒå›´ç»•ç€Envoy sideCaræ„å»ºã€‚æ¯ä¸ªæœåŠ¡å®ä¾‹æ—è¾¹éƒ½ä¼šéƒ¨ç½²ä¸€ä¸ªEnvoyä»£ç†ï¼Œè´Ÿè´£å¤„ç†è¿›å‡ºæœåŠ¡çš„æ‰€æœ‰ç½‘ç»œæµé‡ã€‚ è¿™ä¸€è®¾è®¡å…è®¸Istioåœ¨é€æ˜åœ°æ‹¦æˆªã€è·¯ç”±å’Œç›‘æ§æ‰€æœ‰é€šä¿¡çš„åŒæ—¶ï¼Œä¸å¯¹æœåŠ¡ä»£ç æœ¬èº«åšå‡ºä»»ä½•ä¿®æ”¹ã€‚&#xA;Istio sidecar æ³¨å…¥è¿‡ç¨‹ Istio sidecar æ³¨å…¥è¿‡ç¨‹æ˜¯æŒ‡åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œå°† Istio çš„ Envoy ä»£ç†ä½œä¸ºä¸€ä¸ª sidecar å®¹å™¨ï¼Œæ³¨å…¥åˆ°æ¯ä¸ªä¸šåŠ¡å®¹å™¨æ‰€åœ¨çš„ Pod ä¸­ï¼Œä»è€Œå®ç°å¯¹ä¸šåŠ¡å®¹å™¨çš„æµé‡ç®¡ç†å’Œæ§åˆ¶ã€‚&#xA;Istio sidecar æ³¨å…¥è¿‡ç¨‹ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼šæ‰‹åŠ¨æ³¨å…¥å’Œè‡ªåŠ¨æ³¨å…¥ã€‚&#xA;æ‰‹åŠ¨æ³¨å…¥æ˜¯æŒ‡åœ¨åˆ›å»º Pod æ—¶ï¼Œåœ¨ Pod çš„ YAML æ–‡ä»¶ä¸­ï¼Œæ‰‹åŠ¨æ·»åŠ  Istio çš„ Envoy ä»£ç†å®¹å™¨ï¼Œå¹¶ä¸”é…ç½®å¥½ Istio å’Œ Envoy ä»£ç†å®¹å™¨ä¹‹é—´çš„é€šä¿¡æ–¹å¼ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒç¹çï¼Œä¸”å®¹æ˜“å‡ºé”™ã€‚&#xA;è‡ªåŠ¨æ³¨å…¥æ˜¯æŒ‡åœ¨åˆ›å»º Pod æ—¶ï¼Œç”± Istio çš„ sidecar æ³¨å…¥å™¨ï¼ˆIstio-sidecar-injectorï¼‰è‡ªåŠ¨å°† Istio çš„ Envoy ä»£ç†å®¹å™¨æ³¨å…¥åˆ° Pod ä¸­ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒç®€ä¾¿ï¼Œä¸”å¯ä»¥ä¿è¯ Istio å’Œ Envoy ä»£ç†å®¹å™¨ä¹‹é—´çš„é€šä¿¡æ–¹å¼æ˜¯æ­£ç¡®çš„ã€‚&#xA;Istio-sidecar-injector çš„å·¥ä½œåŸç†æ˜¯åŸºäº Kubernetes çš„ Admission Controller æœºåˆ¶ã€‚åœ¨åˆ›å»º Pod æ—¶ï¼ŒKubernetes ä¼šå°† Pod çš„åˆ›å»ºè¯·æ±‚æäº¤ç»™ Admission Controller è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæ ¡éªŒé€šè¿‡ï¼Œåˆ™å°† Pod åˆ›å»ºæˆåŠŸã€‚Istio-sidecar-injector å°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ Admission Controllerï¼Œå®ƒåœ¨æ¥æ”¶åˆ° Pod çš„åˆ›å»ºè¯·æ±‚æ—¶ï¼Œä¼šå°† Istio çš„ Envoy ä»£ç†å®¹å™¨æ³¨å…¥åˆ° Pod ä¸­ï¼Œç„¶åå°†ä¿®æ”¹åçš„ Pod åˆ›å»ºè¯·æ±‚æäº¤ç»™ Kubernetes è¿›è¡Œåˆ›å»ºã€‚</description>
    </item>
    <item>
      <title>å¦‚ä½•åœ¨åŒä¸€ä¸ªk8s clusterä¸­å®‰è£…å¤šä¸ªistioç‰ˆæœ¬</title>
      <link>http://localhost:1313/istio/how-to-install-multi-istio-control-plane/</link>
      <pubDate>Thu, 20 Jun 2024 16:23:23 +0800</pubDate>
      <guid>http://localhost:1313/istio/how-to-install-multi-istio-control-plane/</guid>
      <description>å‡†å¤‡å·¥ä½œ é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªNameSpaceistio-canary &amp;amp; istio-prod,åˆ†åˆ«ç”¨äºéƒ¨ç½²istioçš„canaryç‰ˆæœ¬å’Œprodç‰ˆæœ¬ï¼Œç„¶åæˆ‘ä»¬ç»™è¿™ä¸¤ä¸ªNameSpaceæ‰“ä¸Šæ ‡ç­¾ï¼Œç”¨äºåç»­çš„istioçš„ç‰ˆæœ¬é€‰æ‹©ã€‚&#xA;âœ ~ k create ns istio-canary âœ ~ k create ns istio-prod âœ ~ k label ns istio-canary istio-tag=istio-canary âœ ~ k label ns istio-prod istio-tag=istio-prod æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¦å®‰è£…istioçš„ç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©äº†1.19.3å’Œ1.18.5ä¸¤ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«ç”¨äºcanaryå’Œprodçš„ç‰ˆæœ¬ã€‚&#xA;âœ ~ curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.19.3 sh - âœ ~ curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.18.5 sh - é¦–å…ˆç»™ä¸¤ä¸ªç‰ˆæœ¬çš„istioctlè®¾ç½®aliasï¼Œæ–¹ä¾¿åç»­çš„æ“ä½œã€‚&#xA;âœ ~ istioctl1.9=&amp;#39;~/istio-1.19.3/bin/istioctl&amp;#39; âœ ~ istioctl1.8=&amp;#39;~/istio-1.18.5/bin/istioctl&amp;#39; å¼€å§‹å®‰è£…istio æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥åœ¨istio-canaryçš„NameSpaceä¸­å®‰è£…istio 1.19.3ç‰ˆæœ¬&#xA;âœ ~ istioctl1.9 install -y -f - &amp;lt;&amp;lt;EOF apiVersion: install.istio.io/v1alpha1 kind: IstioOperator metadata: namespace: istio-canary name: istio-1-19-3 spec: profile: default revision: 1-19-3 tag: 1.</description>
    </item>
    <item>
      <title>åœ¨å¤šä¸ªistioç‰ˆæœ¬çš„k8sç¯å¢ƒä¸­æ„å»ºåº”ç”¨</title>
      <link>http://localhost:1313/istio/build-app-under-multi-istio/</link>
      <pubDate>Thu, 20 Jun 2024 16:20:52 +0800</pubDate>
      <guid>http://localhost:1313/istio/build-app-under-multi-istio/</guid>
      <description>æœ¬æ•™ç¨‹ä¸»è¦åŸºäºIstioå®˜æ–¹æ–‡æ¡£ä¸­çš„ Bookinfo Applicationï¼Œåœ¨å¤šä¸ªistioç‰ˆæœ¬çš„k8sç¯å¢ƒä¸­æ„å»ºåº”ç”¨ã€‚&#xA;å‰ææ¡ä»¶ è¯·å…ˆå‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« Kubernetesé›†ç¾¤ä¸­çš„Istioç¯å¢ƒç®¡ç†:æ§åˆ¶å¹³é¢çš„å¤šå®ä¾‹éƒ¨ç½²å®è·µé…ç½®å¥½ç›¸åº”çš„istioç¯å¢ƒï¼Œ æ¥ä¸‹æ¥è¯·å°†å¯¹åº”çš„bookinfo.yaml æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚&#xA;å¼€å§‹å®‰è£…bookInfoåº”ç”¨ é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥åœ¨l7-traffic-alpha namespaceä¸­å®‰è£…bookInfoåº”ç”¨&#xA;âœ ~ k apply -f book-info.yaml -n l7-traffic-alpha # service/details created # serviceaccount/bookinfo-details created # deployment.apps/details-v1 created # service/ratings created # serviceaccount/bookinfo-ratings created # deployment.apps/ratings-v1 created # service/reviews created # serviceaccount/bookinfo-reviews created # deployment.apps/reviews-v1 created # deployment.apps/reviews-v2 created # deployment.apps/reviews-v3 created # service/productpage created # serviceaccount/bookinfo-productpage created # deployment.apps/productpage-v1 created é€šè¿‡ä¸‹é¢å‘½ä»¤æ¥æŸ¥çœ‹å¯¹åº”çš„svcå’Œpodæ˜¯å¦å·²ç»åˆ›å»ºæˆåŠŸ,æˆ‘ä»¬å¯ä»¥å‘ç°å¯¹åº”çš„svcå·²ç»åˆ›å»ºæˆåŠŸ&#xA;âœ ~ k get svc -n l7-traffic-alpha NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE details ClusterIP 100.</description>
    </item>
    <item>
      <title>Istioä¸Šæ¸¸è¿æ¥é‡ç½®502é”™è¯¯åˆ†æä¸æ’æŸ¥æŒ‡å—</title>
      <link>http://localhost:1313/istio/istio-upstream-error/</link>
      <pubDate>Fri, 14 Jun 2024 17:47:42 +0800</pubDate>
      <guid>http://localhost:1313/istio/istio-upstream-error/</guid>
      <description>æœ¬æ–‡æ˜¯How to debug Istio Upstream Reset 502 UPE (old 503 UC)çš„ä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬ï¼Œå†…å®¹æœ‰åˆ å‡&#xA;Istio æ˜¯ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿã€‚å¯¹äºåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå®ƒçš„ä¸»è¦ç»„ä»¶æ˜¯ sidecar å®¹å™¨ Istio-Proxyï¼Œå®ƒä»£ç† Pod ä¸­æ‰€æœ‰å®¹å™¨çš„æµé‡ã€‚è€Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ã€‚&#xA;é—®é¢˜é‡ç°ğŸ› åœ¨ä¸€ä¸ªæ‹¥æœ‰è¶…è¿‡ 40 ä¸ªä¸åŒå¾®æœåŠ¡çš„å¤§å‹ç³»ç»Ÿä¸­ï¼ŒQAå·¥ç¨‹å¸ˆåœ¨å•ä¸ªç«¯ç‚¹ä¸Šå‘ç°äº†ä¸€ä¸ªbugã€‚è¿™è¯¥ç«¯ç‚¹æ˜¯ POST ç«¯ç‚¹ï¼Œå®ƒè¿”å›åˆ†å—ï¼ˆchunkedï¼‰æ•°æ®ã€‚&#xA;ç„¶åæˆ‘ä»¬å‘ç° Istio è¿”å›äº† 502 é”™è¯¯ï¼ŒIstioæ—¥å¿—ä¸­è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„æ ‡å¿—ï¼šupstream_reset_before_response_startedã€‚ç„¶è€Œåº”ç”¨ç¨‹åºæ—¥å¿—è¯å®äº†ç»“æœæ˜¯æ­£ç¡®çš„ã€‚&#xA;åœ¨æ—§ç‰ˆæœ¬çš„ Istio ä¸­ï¼Œå®ƒä¼šè¿”å› 503 é”™è¯¯ï¼Œå¸¦æœ‰ UC æ ‡å¿—ã€‚&#xA;é—®é¢˜åˆ†æâ›ï¸ è®©æˆ‘ä»¬çœ‹çœ‹ curl çš„å“åº”ï¼Œä»¥åŠ Istio-proxy çš„æ—¥å¿—ï¼š&#xA;kubectl exec -it curl-0 -- curl http://http-chunked:8080/wrong -v &amp;lt; HTTP/1.1 502 Bad Gateway &amp;lt; content-length: 87 &amp;lt; content-type: text/plain &amp;lt; date: Sun, 24 Apr 2022 12:28:28 GMT &amp;lt; server: istio-envoy &amp;lt; x-envoy-decorator-operation: http-chunked.</description>
    </item>
  </channel>
</rss>
